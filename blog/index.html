<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>MathxH&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="System Software Engineer">
<meta property="og:type" content="website">
<meta property="og:title" content="MathxH&#39;s Blog">
<meta property="og:url" content="https://alexiachen.github.io/blog/index.html">
<meta property="og:site_name" content="MathxH&#39;s Blog">
<meta property="og:description" content="System Software Engineer">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MathxH&#39;s Blog">
<meta name="twitter:description" content="System Software Engineer">
  
    <link rel="alternate" href="/blog/atom.xml" title="MathxH&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">MathxH&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">just life in general</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
          <a class="main-nav-link" href="/blog/about">About</a>
        
          <a class="main-nav-link" href="/blog/resume">Resume</a>
        
      </nav>
      <nav id="sub-nav">
        <a></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://alexiachen.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-bloom-filter" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/03/17/bloom-filter/" class="article-date">
  <time datetime="2019-03-17T04:26:00.000Z" itemprop="datePublished">2019-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/03/17/bloom-filter/">实现一个简单的高性能布隆过滤器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="布隆过滤器是什么"><a href="#布隆过滤器是什么" class="headerlink" title="布隆过滤器是什么"></a>布隆过滤器是什么</h2><hr>
<p>它是一个数据结构，而且一般传统的科班的算法书不会讲到。它可以用来判断某个元素是否在集合内，具有执行速度快和内存占用小的特点。</p>
<p>布隆过滤器高效的插入和查询代价就是：<a href="https://en.wikipedia.org/wiki/Bloom_filter" target="_blank" rel="noopener">Bloom Filter</a>是一个基于概率的数据结构：它只能告诉我们一个元素的以下两种查询结果：</p>
<ul>
<li>绝对不在集合内</li>
<li>可能在集合内 </li>
</ul>
<p>针对第二点，也就说可能会有false positive。朴素的布隆过滤器一般是不支持删除操作的，但是也有针对具体应用而产生支持删除操作的布隆过滤器。这个延伸问题我不打算涉及，感兴趣可以查找下相关论文。</p>
<h2 id="布隆过滤器的简单原理以及实现"><a href="#布隆过滤器的简单原理以及实现" class="headerlink" title="布隆过滤器的简单原理以及实现"></a>布隆过滤器的简单原理以及实现</h2><hr>
<h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p>布隆过滤器的一个基础的数据结构就是一个<a href="https://en.wikipedia.org/wiki/Bit_array" target="_blank" rel="noopener">Bit Vector</a> 。 其原理非常简单，这个bit 数组是带有下标索引的，一个索引对应一个bit状态，实际就是0或1。 一般状态1就是元素存在的标识，状态0就是元素不存在的标识。</p>
<p>00000000000100010100101010101010101010101010100101010000001111100111</p>
<p>以上的文本示例就是一个长度为N的比特向量，当然初始状态但是是全为0，但一旦向布隆过滤器插入一个元素的时候，需要对这个元素进行多次hash运算，一次运算的结果为bit vector的一个下标索引，然后把这个索引对应的bit状态设置为1，当多次Hash运算计算下标完成并设置为1，这样元素就算插入完成了。查询的时候也是把元素进行多次hash运算，然后检查对应索引上的bit状态是否为1，如果多次运算后的bit为1就是可能存在，如果其中有一个bit为0，就是绝对不存在。</p>
<p>以上就是布隆过滤器的最基本原理了。是不是很简单？ 但是要对其进行分析就需要一定难度了，其中需要你懂些基本的数学知识，比如如果你要设计一个布隆过滤器，以下几个方面需要你来取舍：</p>
<ul>
<li><p>长度为m的比特向量，这个长度需要多长？m需要多大？也就是说需要几个bit？</p>
</li>
<li><p>进行多次hash运算，这个多次是需要不同的k个Hash函数的，那么这k个Hash函数怎么选择？ MD5，SHA256还是其他？这个K的最优值又是什么？</p>
</li>
<li><p>已知当前比特向量已经插入n个元素了，那么过滤器判断的误报率(false positive)又是怎样的？毕竟是概率性数据结构。</p>
</li>
</ul>
<p>如果以上三个要点实现过滤器的设计者没有考虑清楚，很可能他设计出来的过滤器根本不可用，误报率上升到一定程度就没有意义了。</p>
<h3 id="Hash函数的选择"><a href="#Hash函数的选择" class="headerlink" title="Hash函数的选择"></a>Hash函数的选择</h3><p>布隆过滤器里的Hash函数最好是要选择<a href="https://en.wiktionary.org/wiki/independent_function#English" target="_blank" rel="noopener">彼此独立</a>的, 而且是要<a href="https://en.wikipedia.org/wiki/Discrete_uniform_distribution" target="_blank" rel="noopener">离散均匀分布</a>的。也就是说Hash函数的结果要等可能（等概率）的落在一个[a, b]区间任的一点（点是非连续的，离散的），如果概率不等，那么在某个bit下标区间内误报的概率就会上升。当然最后，Hash函数还要尽可能的快，虽然是Hash函数时间复杂度都是常数级别，最好是降低下常数吧。</p>
<p>所以适合于做布隆过滤器的Hash函数有： </p>
<ul>
<li><p><a href="https://en.wikipedia.org/wiki/MurmurHash" target="_blank" rel="noopener">murmur系列</a>Hash函数</p>
</li>
<li><p><a href="https://en.wikipedia.org/wiki/Fowler–Noll–Vo_hash_function" target="_blank" rel="noopener">Fowler–Noll–Vo系列</a>Hash函数</p>
</li>
</ul>
<p>当然还有其他的。如果你仔细分析，你会发现以上两个系列的Hash函数都不是为密码学设计的，一般来说不是以密码学为目的设计的Hash函数速度会更快。所以<a href="https://en.wikipedia.org/wiki/MD5" target="_blank" rel="noopener">MD5</a>， <a href="https://en.wikipedia.org/wiki/SHA-1" target="_blank" rel="noopener">SHA-1</a>， <a href="https://en.wikipedia.org/wiki/SHA-2" target="_blank" rel="noopener">SHA-2</a>这些算法就不太合适用来做布隆过滤器的Hash函数。</p>
<p>如果你有所怀疑的话，那么可以参考一下这个<a href="https://github.com/bitly/dablooms/pull/19" target="_blank" rel="noopener">PR</a>，当把布隆过滤器的实现从MD5切换到murmur时，极大的提高了性能。</p>
<p>当然，也有其他布隆过滤器采用为密码学设计的Hash算法的，这里暂时先不去研究为什么了。</p>
<h3 id="比特向量已经设计为多大？"><a href="#比特向量已经设计为多大？" class="headerlink" title="比特向量已经设计为多大？"></a>比特向量已经设计为多大？</h3><p>布隆过滤器的一个优良特性就是可以调整过滤器的误报率。拥有一个大的比特向量的过滤器会拥有比一个相对较小的过滤器有着更低的误报率。</p>
<p>误报率会近似于以下公式：</p>
<p> <img src="http://wx1.sinaimg.cn/large/a1ac93f3gy1g15t747vd0j203p01q3ya.jpg" alt=""></p>
<p> 所以你只需要先确定可能插入的数据集的容量大小n, 然后再调整k和m来为你的场景配置过滤器。</p>
<p>所以根据以上公式，你不得不带出来另一个问题，就是K的取值是多少？ 也就是说，几个Hash函数才合适？</p>
<p>布隆过滤器使用的Hash函数越多运行速度就会越慢。但是如果Hash函数过少，又会遇到误报率高的问题。所以这个问题上需要认真考虑权衡。</p>
<p>在创建布隆过滤器的时候需要确定k的值，也就是说你需要提前规划n的变动范围。而一旦你这样做了，你依然需要确定m（比特向量长度）和 k (Hash函数的个数）的值。</p>
<p>似乎这是一个十分困难的优化问题，但幸运的是，对于给定的m和n，有一个函数可以帮我们确定最优的k值(公式来自于wiki): </p>
<p><img src="http://wx1.sinaimg.cn/large/a1ac93f3gy1g15tqjkxm7j209701tglf.jpg" alt=""></p>
<p>当然，有篇论文叫做<a href="https://www.eecs.harvard.edu/~michaelm/postscripts/tr-02-05.pdf" target="_blank" rel="noopener">Building a better bloom filter（Adam Kirsch）</a>已经证明了，其中布隆过滤器只需要2个Hash函数就可以模拟k个Hash函数，并且不会降低精准度。论文中指出以下公式：</p>
<p>Gi(x) = H1(x) +iH2(x).</p>
<p>H1，H2分别是两个互相独立并且离散均匀分布的两个Hash函数，其中 0 &lt;= i &lt;= k - 1 。</p>
<p>当然对于比特向量的索引下标就是最终Hash的结果对向量大小取模就可以了：</p>
<p>index = [hash-value] mod [size of vector]  </p>
<p>所以，可以通过以下4个步骤来确定过滤器的大小：</p>
<ul>
<li>1.确定n的变动范围</li>
<li>2.选定m的值</li>
<li>3.通过公式计算k的最优值（k可以用2个Hash函数的线性组合代替）</li>
<li>4.通过m，n，k计算误报率，如果误报率不在你接受的限度，那么你需要重回步骤2，否则就结束</li>
</ul>
<h3 id="基本实现"><a href="#基本实现" class="headerlink" title="基本实现"></a>基本实现</h3><p>如果用C++模拟比特向量，可以用std::vector\&lt;bool>来模拟，一般来说别担心bool在vector里面每个元素是占sizeof(bool)个字节。反而这<a href="https://en.cppreference.com/w/cpp/container/vector_bool" target="_blank" rel="noopener">很可能是被优化了</a>，在bool向量中，bool可能被优化成只占一个Bit 。 当然这具体看实现（implementation defined），一般来说占用空间是被优化掉了。</p>
<p>过滤器的add方法:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// m = size of bit vector</span></span><br><span class="line"><span class="comment">// Gi(x)= H1(x) + i * H2(x)</span></span><br><span class="line"><span class="comment">// index = Gi(x) mod m</span></span><br><span class="line"><span class="keyword">uint64_t</span> indexHash(<span class="keyword">uint8_t</span> i, <span class="keyword">uint64_t</span> hashA, <span class="keyword">uint64_t</span> hashB, <span class="keyword">uint64_t</span> m)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (hashA + i * hashB) % m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// you need to serialize an object to bytes array</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addObject</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint8_t</span>&gt;&amp; data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// you need to choose HashA and HashB</span></span><br><span class="line">    hash_a = HashA(data.data(),data.size());</span><br><span class="line">    hash_b = HashB(data.data(),data.size());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k - <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">uint64_t</span> index = indexHash(i, hash_a, hash_b, bit_vector.size()); </span><br><span class="line">        bit_vector[index] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>过滤器的contains方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// you need to serialize an object to bytes array</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">maybe_contains</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint8_t</span>&gt;&amp; data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hash_a = HashA(data.data(),data.size());</span><br><span class="line">    hash_b = HashB(data.data(),data.size());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k - <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">uint64_t</span> index = indexHash(i, hash_a, hash_b, bit_vector.size()); </span><br><span class="line">        <span class="keyword">if</span>(!bit_vector[index]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上实现的过滤，查找在亿级对象数据量中判断某对象是否存在基本平均响应在纳秒时间。</p>
<p>一般来说，如果不是出什么特别的差错，在大部分场景下误报率几乎可以忍受。</p>
<p>EOF</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2019/03/17/bloom-filter/" data-id="cjtctqoom006tufqf56q3nhbq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Bloom-Filter/">Bloom Filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/数据结构与算法/">数据结构与算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-auto-complete-markov-chain" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/03/10/auto-complete-markov-chain/" class="article-date">
  <time datetime="2019-03-10T07:26:00.000Z" itemprop="datePublished">2019-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/03/10/auto-complete-markov-chain/">用马尔科夫链来做自动补全</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>马尔科夫链是个什么呢？如果你去网上搜索， 噼里啪啦一堆公式，可能你会看的不耐烦了。当然，你可能见到有些人总结了一句经典的话，比如：</p>
<ul>
<li><p>如果将下一个状态的依赖条件，简化成：仅取决于当前状态，和之前其他状态无关。那么，这个随机过程就是马尔可夫链。</p>
</li>
<li><p>今天的事情只取决于昨天，而明天的事情只取决于今天，与历史毫无关联</p>
</li>
</ul>
<p>当然，你可以在<a href="https://www.zhihu.com/question/26665048" target="_blank" rel="noopener">知乎这里</a>看到更多的解释。</p>
<p>这样的性质就给我们带来了预测下一个状态带来了可能，比如天气预报，智能联想提示等等。</p>
<p>今天我们就用python来用马尔科夫链来做点有实际意义的事情，用更直观的角度理解它。</p>
<p>正文是我用python脚本来分析了一本英文书，把这本书的英文句子作为一个训练集，用<a href="https://en.wikipedia.org/wiki/Markov_chain" target="_blank" rel="noopener">马尔科夫链</a>来做处理产生短文，短文句子有一定“联想”，这样也可以算作是一个自动补全的程序了。比如，一些聊天工具和输入法可能就有这样的功能，基于你以前历史的语句输入来判断你当前输入后面可能会输入的单词或语句作提示或者补全。</p>
<p>网络社区也有一些爱好者用<a href="https://blog.csdn.net/renhaofan/article/details/82191387" target="_blank" rel="noopener">马尔科夫链来生成鸡汤文</a>， 都算是一定性质的科普文章。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><hr>
<p>首先，需要随便下载一个英文小说或者书籍来作为训练集合，英文当然越正宗越地道越好，这样的数据质量比较高，之后生成的段落语句结果也更好些。这里我下载了<a href="http://vdisk.weibo.com/s/uiFtZjZIxy3Gz" target="_blank" rel="noopener">哈利波特1-7的英文txt</a>。哈哈，英文原版我只读了第一部魔法石，惭愧啊。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python 3! due to random.choices()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> operator, random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_empty_words</span><span class="params">(l)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> list(filter(<span class="keyword">lambda</span> a: a != <span class="string">''</span>, l))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_occ</span><span class="params">(d, seq, w)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> seq <span class="keyword">not</span> <span class="keyword">in</span> d:</span><br><span class="line">        d[seq]=defaultdict(int)</span><br><span class="line"></span><br><span class="line">    d[seq][w]=d[seq][w]+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://docs.python.org/3/library/random.html#random.choice</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_random_from_table</span><span class="params">(t)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> random.choices(list(t.keys()), weights=list(t.values()))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">with</span> open (<span class="string">"harry-potter.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> myfile:</span><br><span class="line">        data=myfile.read()</span><br><span class="line"></span><br><span class="line">    sentences=data.lower().replace(<span class="string">'\r'</span>,<span class="string">' '</span>).replace(<span class="string">'\n'</span>,<span class="string">' '</span>).replace(<span class="string">'?'</span>,<span class="string">'.'</span>).replace(<span class="string">'!'</span>,<span class="string">'.'</span>).replace(<span class="string">'“'</span>,<span class="string">'.'</span>).replace(<span class="string">'”'</span>,<span class="string">'.'</span>).replace(<span class="string">"\""</span>,<span class="string">"."</span>).replace(<span class="string">'‘'</span>,<span class="string">' '</span>).replace(<span class="string">'-'</span>,<span class="string">' '</span>).replace(<span class="string">'’'</span>,<span class="string">' '</span>).replace(<span class="string">'\''</span>,<span class="string">' '</span>).split(<span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># key=list of words, as a string, delimited by space</span></span><br><span class="line">    <span class="comment">#     (I would use list of strings here as key, but list in not hashable)</span></span><br><span class="line">    <span class="comment"># val=dict, k: next word; v: occurrences</span></span><br><span class="line">    first=&#123;&#125;</span><br><span class="line">    second=&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> sentences:</span><br><span class="line">        words=s.replace(<span class="string">','</span>,<span class="string">' '</span>).split(<span class="string">" "</span>)</span><br><span class="line">        words=remove_empty_words(words)</span><br><span class="line">        <span class="keyword">if</span> len(words)==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(words)):</span><br><span class="line">            <span class="keyword">if</span> i&gt;=<span class="number">1</span>:</span><br><span class="line">                update_occ(first, words[i<span class="number">-1</span>], words[i])</span><br><span class="line">            <span class="keyword">if</span> i&gt;=<span class="number">2</span>:</span><br><span class="line">                update_occ(second, words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>], words[i])</span><br><span class="line"></span><br><span class="line">    text=[<span class="string">"magic"</span>, <span class="string">"is"</span>]</span><br><span class="line"></span><br><span class="line">    text_len=len(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line"></span><br><span class="line">        last_idx=text_len<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        tmp=text[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+text[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> second:</span><br><span class="line">            new_word=gen_random_from_table(second[tmp])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># fall-back to 1st order</span></span><br><span class="line">            tmp2=text[last_idx]</span><br><span class="line">            <span class="keyword">if</span> tmp2 <span class="keyword">not</span> <span class="keyword">in</span> first:</span><br><span class="line">                <span class="comment"># dead-end</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            new_word=gen_random_from_table(first[tmp2])</span><br><span class="line"></span><br><span class="line">        text.append(new_word)</span><br><span class="line">        text_len=text_len+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">" "</span>.join(text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># main function</span></span><br><span class="line">process()</span><br></pre></td></tr></table></figure>
<p>运行以上代码，就可以生成一个150来个单词的”联想”短文了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">magic is not having practised vanishing spells horribly difficult at first but they two thousand racing broom tampering and torture; </span><br><span class="line">an interview said harry leaping to their bulky backpacks the nine of the cottages were fewer here and make it too far; </span><br><span class="line">it rolled over toward him holding a wand to shoulder wands raised james glancing over his head pound so he went as red as ron who clambered to</span><br><span class="line"> his determination to shut his eyes wanting to know anything new right before you go upstairs with ron eating their way around the walls and </span><br><span class="line"> all their shock and exhaustion that the phoenix but after a few horrible seconds he did to open the lestranges vault only once a month </span><br><span class="line"> later harry kept his eyes was twitching slightly hair whipped back off the </span><br><span class="line"> pitch but all three of my followers would give better cover they extinguished their fire then he sat down when something of a voice </span><br><span class="line"> and called out of pure venom at harry his temper getting the exit and when sounds of someone stumbling ftom a room like a venomous bubble compressing his lungs driving all other concerns fled </span><br><span class="line"> harry s head with a large fir tree blocking the top</span><br></pre></td></tr></table></figure>
<p>当然这段短文有点狗屁不通，甚至有点搞笑，我们现在先不管。</p>
<p>我们先来看看代码中的first和second变量，它们是一个字典。</p>
<p>first变量表示第一个单词后出现的单词的概率统计，这是一阶马尔科夫链生成的数据结果。</p>
<p>我们通过python把first的结果排序打印出来好了:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> (<span class="string">"first table:"</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> first:</span><br><span class="line">    <span class="keyword">print</span> (k)</span><br><span class="line">    <span class="comment"># https://stackoverflow.com/questions/613183/how-do-i-sort-a-dictionary-by-value</span></span><br><span class="line">    s=sorted(first[k].items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">print</span> (s[:<span class="number">20</span>])</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">harry</span><br><span class="line">[(&apos;s&apos;, 1344), (&apos;and&apos;, 776), (&apos;had&apos;, 657), (&apos;was&apos;, 475), (&apos;could&apos;, 400), (&apos;potter&apos;, 385), (&apos;said&apos;, 358), (&apos;saw&apos;, 271), (&apos;looked&apos;, 241), (&apos;felt&apos;, 238), (&apos;ron&apos;, 233), (&apos;who&apos;, 201), (&apos;thought&apos;, 172), (&apos;asked&apos;, 163), (&apos;as&apos;, 160), (&apos;knew&apos;, 156), (&apos;did&apos;, 125), (&apos;i&apos;, 115), (&apos;to&apos;, 108), (&apos;in&apos;, 106)]</span><br><span class="line"></span><br><span class="line">potter</span><br><span class="line">[(&apos;and&apos;, 63), (&apos;s&apos;, 59), (&apos;said&apos;, 28), (&apos;is&apos;, 26), (&apos;you&apos;, 23), (&apos;has&apos;, 21), (&apos;i&apos;, 18), (&apos;the&apos;, 17), (&apos;was&apos;, 13), (&apos;he&apos;, 13), (&apos;sir&apos;, 13), (&apos;will&apos;, 10), (&apos;had&apos;, 10), (&apos;she&apos;, 10), (&apos;in&apos;, 9), (&apos;must&apos;, 9), (&apos;that&apos;, 9), (&apos;stinks&apos;, 7), (&apos;not&apos;, 6), (&apos;come&apos;, 5)]</span><br><span class="line"></span><br><span class="line">and</span><br><span class="line">[(&apos;the&apos;, 1225), (&apos;hermione&apos;, 954), (&apos;he&apos;, 907), (&apos;harry&apos;, 662), (&apos;a&apos;, 605), (&apos;then&apos;, 554), (&apos;ron&apos;, 550), (&apos;i&apos;, 541), (&apos;his&apos;, 363), (&apos;george&apos;, 341), (&apos;it&apos;, 298), (&apos;they&apos;, 289), (&apos;you&apos;, 253), (&apos;she&apos;, 243), (&apos;was&apos;, 232), (&apos;that&apos;, 211), (&apos;there&apos;, 190), (&apos;saw&apos;, 187), (&apos;said&apos;, 171), (&apos;looked&apos;, 161)]</span><br><span class="line"></span><br><span class="line">the</span><br><span class="line">[(&apos;door&apos;, 770), (&apos;dark&apos;, 637), (&apos;room&apos;, 629), (&apos;other&apos;, 548), (&apos;ministry&apos;, 477), (&apos;first&apos;, 455), (&apos;floor&apos;, 408), (&apos;same&apos;, 386), (&apos;way&apos;, 362), (&apos;end&apos;, 362), (&apos;castle&apos;, 358), (&apos;air&apos;, 334), (&apos;ground&apos;, 326), (&apos;only&apos;, 326), (&apos;back&apos;, 317), (&apos;last&apos;, 296), (&apos;table&apos;, 292), (&apos;rest&apos;, 284), (&apos;front&apos;, 263), (&apos;death&apos;, 260)]</span><br><span class="line"></span><br><span class="line">sorcerer</span><br><span class="line">[(&apos;s&apos;, 24), (&apos;in&apos;, 3), (&apos;of&apos;, 1), (&apos;spoke&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>好了，我们现在再来看看second变量的结果，它表示两个单词之后出现的每个单词的概率统计，这是二阶马尔科夫链的结果，依次类推，还有3阶马尔科夫链，只不过代码里面没写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> (<span class="string">"second table:"</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> second:</span><br><span class="line">        <span class="keyword">print</span> (k)</span><br><span class="line">        <span class="comment"># https://stackoverflow.com/questions/613183/how-do-i-sort-a-dictionary-by-value</span></span><br><span class="line">        s=sorted(second[k].items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">print</span> (s[:<span class="number">20</span>])</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">which made</span><br><span class="line">[(&apos;the&apos;, 3), (&apos;it&apos;, 2), (&apos;harry&apos;, 2), (&apos;drills&apos;, 1), (&apos;professor&apos;, 1), (&apos;ginny&apos;, 1), (&apos;his&apos;, 1), (&apos;ron&apos;, 1), (&apos;him&apos;, 1), (&apos;a&apos;, 1)]</span><br><span class="line"></span><br><span class="line">he was</span><br><span class="line">[(&apos;going&apos;, 96), (&apos;not&apos;, 88), (&apos;a&apos;, 66), (&apos;still&apos;, 65), (&apos;sure&apos;, 50), (&apos;in&apos;, 47), (&apos;doing&apos;, 43), (&apos;the&apos;, 42), (&apos;looking&apos;, 40), (&apos;wearing&apos;, 38), (&apos;so&apos;, 32), (&apos;about&apos;, 29), (&apos;trying&apos;, 29), (&apos;on&apos;, 27), (&apos;being&apos;, 25), (&apos;very&apos;, 22), (&apos;lying&apos;, 22), (&apos;standing&apos;, 22), (&apos;too&apos;, 19), (&apos;supposed&apos;, 19)]</span><br><span class="line"></span><br><span class="line">was a</span><br><span class="line">[(&apos;very&apos;, 48), (&apos;loud&apos;, 39), (&apos;pause&apos;, 35), (&apos;great&apos;, 35), (&apos;long&apos;, 25), (&apos;bit&apos;, 22), (&apos;little&apos;, 20), (&apos;good&apos;, 19), (&apos;large&apos;, 16), (&apos;moment&apos;, 16), (&apos;flash&apos;, 15), (&apos;few&apos;, 14), (&apos;small&apos;, 14), (&apos;tiny&apos;, 13), (&apos;wizard&apos;, 12), (&apos;bang&apos;, 12), (&apos;nasty&apos;, 11), (&apos;knock&apos;, 11), (&apos;sudden&apos;, 11), (&apos;lot&apos;, 10)]</span><br><span class="line"></span><br><span class="line">a big</span><br><span class="line">[(&apos;mistake&apos;, 3), (&apos;deal&apos;, 3), (&apos;plastic&apos;, 2), (&apos;supporter&apos;, 2), (&apos;party&apos;, 2), (&apos;man&apos;, 2), (&apos;beefy&apos;, 1), (&apos;city&apos;, 1), (&apos;argument&apos;, 1), (&apos;old&apos;, 1), (&apos;photograph&apos;, 1), (&apos;green&apos;, 1), (&apos;lumpy&apos;, 1), (&apos;black&apos;, 1), (&apos;red&apos;, 1), (&apos;thing&apos;, 1), (&apos;drop&apos;, 1), (&apos;enough&apos;, 1), (&apos;bet&apos;, 1), (&apos;bearded&apos;, 1)]</span><br><span class="line"></span><br><span class="line">big beefy</span><br><span class="line">[(&apos;man&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>好了，这里先暂时止步探索，你会发现二阶马尔科夫链的结果更加精确，生成的数据集也更加小。这不废话嘛，就像猜谜语一样，提示给的越精确越多，那么你猜中的概率越大，解的空间范围就缩小了，second表也就更小了。哈哈，开始有点意思了。</p>
<p>好的，我们现在在二阶马尔科夫链的基础上加入3阶马尔科夫链，按照2阶的代码修改就行了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">first=&#123;&#125;</span><br><span class="line">second=&#123;&#125;</span><br><span class="line">third=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> sentences:</span><br><span class="line">    words=s.replace(<span class="string">','</span>,<span class="string">' '</span>).split(<span class="string">" "</span>)</span><br><span class="line">    words=remove_empty_words(words)</span><br><span class="line">    <span class="keyword">if</span> len(words)==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(words)):</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">1</span>:</span><br><span class="line">            update_occ(first, words[i<span class="number">-1</span>], words[i])</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">2</span>:</span><br><span class="line">            update_occ(second, words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>], words[i])</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">3</span>:</span><br><span class="line">            update_occ(third, words[i<span class="number">-3</span>]+<span class="string">" "</span>+words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>],words[i])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">were proud to</span><br><span class="line">[(&apos;say&apos;, 1)]</span><br><span class="line"></span><br><span class="line">proud to say</span><br><span class="line">[(&apos;that&apos;, 1)]</span><br><span class="line"></span><br><span class="line">to say that</span><br><span class="line">[(&apos;he&apos;, 3), (&apos;she&apos;, 3), (&apos;i&apos;, 2), (&apos;they&apos;, 1), (&apos;s&apos;, 1), (&apos;you&apos;, 1), (&apos;his&apos;, 1), (&apos;from&apos;, 1), (&apos;your&apos;, 1), (&apos;at&apos;, 1), (&apos;on&apos;, 1), (&apos;age&apos;, 1), (&apos;dumbledore&apos;, 1), (&apos;it&apos;, 1)]</span><br><span class="line"></span><br><span class="line">say that they</span><br><span class="line">[(&apos;were&apos;, 1), (&apos;know&apos;, 1)]</span><br><span class="line"></span><br><span class="line">that they were</span><br><span class="line">[(&apos;not&apos;, 9), (&apos;all&apos;, 7), (&apos;there&apos;, 3), (&apos;going&apos;, 3), (&apos;alone&apos;, 2), (&apos;being&apos;, 2), (&apos;indeed&apos;, 2), (&apos;in&apos;, 2), (&apos;a&apos;, 2), (&apos;the&apos;, 2), (&apos;still&apos;, 2), (&apos;supposed&apos;, 2), (&apos;no&apos;, 2), (&apos;really&apos;, 2), (&apos;perfectly&apos;, 1), (&apos;related&apos;, 1), (&apos;proud&apos;, 1), (&apos;witches&apos;, 1), (&apos;fifty&apos;, 1), (&apos;already&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>从以上可以看出，3阶显然更精确，并且third表也更小了。</p>
<p>以下为了让各位观众更清晰的看到3阶马尔科夫链的生成结果更准确，我用更加可读的输出打印出来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tests=[<span class="string">"i can tell"</span>, <span class="string">"who did this"</span>, <span class="string">"she was a"</span>, <span class="string">"he was a"</span>, <span class="string">"i did not"</span>,</span><br><span class="line">    <span class="string">"wanted to do"</span>, <span class="string">"you will find"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> test <span class="keyword">in</span> tests:</span><br><span class="line">    test_words=test.split(<span class="string">" "</span>)</span><br><span class="line"></span><br><span class="line">    test_len=len(test_words)</span><br><span class="line">    last_idx=test_len<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">3</span>:</span><br><span class="line">        tmp=test_words[last_idx<span class="number">-2</span>]+<span class="string">" "</span>+test_words[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> third:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* third order. for sequence:"</span>,tmp)</span><br><span class="line">            print_stat(third[tmp])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">2</span>:</span><br><span class="line">        tmp=test_words[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> second:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* second order. for sequence:"</span>, tmp)</span><br><span class="line">            print_stat(second[tmp])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">1</span>:</span><br><span class="line">        tmp=test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> first:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* first order. for word:"</span>, tmp)</span><br><span class="line">            print_stat(first[tmp])</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">* third order. <span class="keyword">for</span> sequence: i can tell</span><br><span class="line">you <span class="number">42</span>%</span><br><span class="line">yeh <span class="number">14</span>%</span><br><span class="line">who <span class="number">7</span>%</span><br><span class="line">he <span class="number">7</span>%</span><br><span class="line">mum <span class="number">7</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: can tell</span><br><span class="line">me <span class="number">25</span>%</span><br><span class="line">you <span class="number">20</span>%</span><br><span class="line">us <span class="number">10</span>%</span><br><span class="line">yeh <span class="number">5</span>%</span><br><span class="line">him <span class="number">5</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: tell</span><br><span class="line">you <span class="number">17</span>%</span><br><span class="line">me <span class="number">14</span>%</span><br><span class="line">him <span class="number">10</span>%</span><br><span class="line">us <span class="number">7</span>%</span><br><span class="line">them <span class="number">5</span>%</span><br><span class="line"></span><br><span class="line">* second order. <span class="keyword">for</span> sequence: did this</span><br><span class="line">mean <span class="number">27</span>%</span><br><span class="line">but <span class="number">9</span>%</span><br><span class="line">year <span class="number">9</span>%</span><br><span class="line">weird <span class="number">9</span>%</span><br><span class="line">band <span class="number">9</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: this</span><br><span class="line"><span class="keyword">is</span> <span class="number">10</span>%</span><br><span class="line">time <span class="number">6</span>%</span><br><span class="line">was <span class="number">5</span>%</span><br><span class="line">year <span class="number">2</span>%</span><br><span class="line">one <span class="number">2</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: she was a</span><br><span class="line">witch <span class="number">12</span>%</span><br><span class="line">bit <span class="number">12</span>%</span><br><span class="line">great <span class="number">8</span>%</span><br><span class="line">very <span class="number">8</span>%</span><br><span class="line">freak <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: was a</span><br><span class="line">very <span class="number">3</span>%</span><br><span class="line">loud <span class="number">3</span>%</span><br><span class="line">pause <span class="number">2</span>%</span><br><span class="line">great <span class="number">2</span>%</span><br><span class="line">long <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: a</span><br><span class="line">few <span class="number">2</span>%</span><br><span class="line">little <span class="number">2</span>%</span><br><span class="line">bit <span class="number">1</span>%</span><br><span class="line">moment <span class="number">1</span>%</span><br><span class="line">very <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: he was a</span><br><span class="line">bit <span class="number">7</span>%</span><br><span class="line">good <span class="number">7</span>%</span><br><span class="line">wizard <span class="number">6</span>%</span><br><span class="line">death <span class="number">6</span>%</span><br><span class="line">big <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: was a</span><br><span class="line">very <span class="number">3</span>%</span><br><span class="line">loud <span class="number">3</span>%</span><br><span class="line">pause <span class="number">2</span>%</span><br><span class="line">great <span class="number">2</span>%</span><br><span class="line">long <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: a</span><br><span class="line">few <span class="number">2</span>%</span><br><span class="line">little <span class="number">2</span>%</span><br><span class="line">bit <span class="number">1</span>%</span><br><span class="line">moment <span class="number">1</span>%</span><br><span class="line">very <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: i did <span class="keyword">not</span></span><br><span class="line">want <span class="number">12</span>%</span><br><span class="line">have <span class="number">8</span>%</span><br><span class="line">know <span class="number">8</span>%</span><br><span class="line">ask <span class="number">4</span>%</span><br><span class="line">fasten <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: did <span class="keyword">not</span></span><br><span class="line">know <span class="number">8</span>%</span><br><span class="line">want <span class="number">7</span>%</span><br><span class="line">seem <span class="number">6</span>%</span><br><span class="line">answer <span class="number">4</span>%</span><br><span class="line">look <span class="number">3</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: <span class="keyword">not</span></span><br><span class="line">to <span class="number">7</span>%</span><br><span class="line">be <span class="number">3</span>%</span><br><span class="line">a <span class="number">2</span>%</span><br><span class="line">have <span class="number">2</span>%</span><br><span class="line">the <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: wanted to do</span><br><span class="line">was <span class="number">33</span>%</span><br><span class="line">the <span class="number">16</span>%</span><br><span class="line">but <span class="number">8</span>%</span><br><span class="line"><span class="keyword">with</span> <span class="number">8</span>%</span><br><span class="line">his <span class="number">8</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: to do</span><br><span class="line"><span class="keyword">with</span> <span class="number">20</span>%</span><br><span class="line">it <span class="number">14</span>%</span><br><span class="line">the <span class="number">4</span>%</span><br><span class="line">something <span class="number">3</span>%</span><br><span class="line">was <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: do</span><br><span class="line">you <span class="number">20</span>%</span><br><span class="line">it <span class="number">12</span>%</span><br><span class="line"><span class="keyword">not</span> <span class="number">8</span>%</span><br><span class="line"><span class="keyword">with</span> <span class="number">6</span>%</span><br><span class="line">that <span class="number">3</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: you will find</span><br><span class="line">that <span class="number">28</span>%</span><br><span class="line">a <span class="number">14</span>%</span><br><span class="line">unless <span class="number">7</span>%</span><br><span class="line">everything <span class="number">7</span>%</span><br><span class="line">on <span class="number">7</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: will find</span><br><span class="line">that <span class="number">23</span>%</span><br><span class="line">it <span class="number">14</span>%</span><br><span class="line">me <span class="number">9</span>%</span><br><span class="line">a <span class="number">9</span>%</span><br><span class="line">uses <span class="number">4</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: find</span><br><span class="line">out <span class="number">19</span>%</span><br><span class="line">a <span class="number">8</span>%</span><br><span class="line">the <span class="number">7</span>%</span><br><span class="line">it <span class="number">5</span>%</span><br><span class="line">him <span class="number">4</span>%</span><br></pre></td></tr></table></figure>
<p>从上面的输出可以看出，i can tell 接 you这个单词的概率42%，要比can tell 接 you这个单词的概率20% 要大。显然结果就更精确了。如果调试得当，那么生成的短文结果可能还真看起来像那么回事。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><hr>
<p>最后，提示一下，first，second，third这三张表可以结合起来使用，third这张表的权重显然更高，依次类推。如果你正在做一个输入法或者聊天提示的功能，可以简单采用这样的方法，先收集用户的输入语句等信息作为训练集合，来构建这几张表，这几张表的优先级最高，优先级最低的是常用的固定成语，词语的搭配，还有流行网络用语等等。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2019/03/10/auto-complete-markov-chain/" data-id="cjtctqool006rufqf63bh3n14" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/自然语言处理/">自然语言处理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/马尔科夫链/">马尔科夫链</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-manjaro-rtl8821ce" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/12/15/manjaro-rtl8821ce/" class="article-date">
  <time datetime="2018-12-15T15:13:47.000Z" itemprop="datePublished">2018-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/12/15/manjaro-rtl8821ce/">manjaro下安装配置无线网卡驱动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>昨天买的小米新款笔记本到货，配置是i5 内存8G DDR4。反正是够我拿来写代码了 = =。 昨晚兴致勃勃地冲回新家，准备把小米本里面的原装windows 10 格了重做一个manjaro linux，但是奇怪的事情是，原本对硬件一向支持友好的manjaro居然装起来找不到无线网络，我靠居然没有支持，查了网卡的型号是Reatek的rtl8821ce的无线网卡，上网一搜，我擦，原来在去年的时候Linux还不支持这个型号的无线网卡。到今年为止才可以<a href="https://ask.csdn.net/questions/662758" target="_blank" rel="noopener">下载到这个型号网卡的驱动</a>。</p>
<p>而且一般OS都不内置，要自己安装，有些时候可能还得<a href="https://blog.csdn.net/qq_33042187/article/details/80462412" target="_blank" rel="noopener">自己编译驱动</a>。最奇怪的是，像manjaro这种内核滚动升级的，时刻保持最新的，居然内核没有带这个驱动。唉，暂时不去研究了。</p>
<p>说多了是泪。TT ， 只有去小区背后的五金店买了个网线先插起来用着，然后通过：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S rtl8821ce-dkms-git</span><br></pre></td></tr></table></figure>
<p>来安装驱动，安装了驱动重启电脑，居然又没有起作用，后来<a href="https://forum.manjaro.org/t/wifi-adapter-not-working/65463" target="_blank" rel="noopener">一查</a>, 才知道还需要安装内核的headers</p>
<p>无奈又通过：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S linux419-headers</span><br></pre></td></tr></table></figure>
<p>因为我是重装的manjaro所以是最新的manjaro18  内核是4.19.x，所以要安装对应的headers。</p>
<p>然后，我擦了，还不起作用，原来还需要启动驱动模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe 8821ce</span><br></pre></td></tr></table></figure>
<p>然后manjaro的xfce的无线管理才能突然搜索到无线网络，唉，可真把我折腾的够呛。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/12/15/manjaro-rtl8821ce/" data-id="cjtctqomz001cufqfn1pzs63l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/无线网卡/">无线网卡</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cpp-closure" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/11/11/cpp-closure/" class="article-date">
  <time datetime="2018-11-11T00:58:23.000Z" itemprop="datePublished">2018-11-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/11/11/cpp-closure/">C++的闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章，我们来一步一步通过C++的来构造闭包。当然，在没有GC的语言中，闭包的特性属于半残，不是很完美。不过虽然不完美，但是还是能构造一些高阶的表达方式的。这篇文章不会讲解闭包的概念。</p>
<p>首先我们构造一个可调用lambda函数的一个函数,注意这时候是不支持返回值的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>()&gt;&amp; fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        fn();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// handle exception here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_line</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; text &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">call([]()&#123; print_line(<span class="string">"called."</span>) &#125;);</span><br></pre></td></tr></table></figure>
<p>当然，我们还可以改造成模板的形式，本质是一样的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Callable&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(<span class="keyword">const</span> Callable&amp; fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fn();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，以上两种方式都没有返回值，如果要支持返回值必须每个返回值类型都指定，比如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">call</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::function&lt;<span class="keyword">double</span>()&gt;&amp; fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">sum</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> result = call([]()&#123; <span class="keyword">return</span> sum(<span class="number">3.14</span>, <span class="number">2.71</span>); &#125;);</span><br></pre></td></tr></table></figure>
<p>这样太不灵活通用了，非常麻烦。其实我们可以通过闭包来巧妙地来达到我们需要的目的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callImpl</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>()&gt;&amp; fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        fn();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// handle exception here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fn&gt;</span><br><span class="line">auto call(const Fn&amp; fn) -&gt; decltype(fn())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">decltype</span>(fn()) result&#123;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> wrapperFn = [&amp;]() -&gt; <span class="keyword">void</span> &#123;</span><br><span class="line">        result = fn();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    callImpl(wrapperFn);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">sum</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> result = call([]()&#123; <span class="keyword">return</span> sum(<span class="number">3.14</span>, <span class="number">2.71</span>); &#125;);</span><br></pre></td></tr></table></figure>
<p>这样lambda函数的返回值类型就不用显式指定了。</p>
<p>但是大家注意到没，到现在虽然call模板函数不用显式指定了，但是还是有返回值的，毕竟最后有一个return result的语句，也就是说，对于没返回值的lambda函数，该模板call函数不支持，还有不完善的地方。导致编译错误。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call([]()&#123; print_line(<span class="string">"called."</span>); &#125;); <span class="comment">// compile error</span></span><br></pre></td></tr></table></figure>
<p>当然，通过C++的模板元编程，我还有可以有方法来解决这个不完善的地方：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callImpl</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>()&gt;&amp; fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        fn();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// handle exception here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fn&gt;</span><br><span class="line">auto call(const Fn&amp; fn) -&gt; decltype(fn())</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">return</span> _call(fn, <span class="built_in">std</span>::is_same&lt;<span class="keyword">decltype</span>(fn()), <span class="keyword">void</span>&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fn&gt;</span><br><span class="line"><span class="keyword">void</span> _call(<span class="keyword">const</span> Fn&amp; fn, <span class="built_in">std</span>::true_type)</span><br><span class="line">&#123;</span><br><span class="line">    callImpl([&amp;]()&#123; fn(); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fn&gt;</span><br><span class="line"><span class="keyword">auto</span> _call(<span class="keyword">const</span> Fn&amp; fn, <span class="built_in">std</span>::false_type) -&gt; <span class="keyword">decltype</span>(fn())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">decltype</span>(fn()) result&#123;&#125;;</span><br><span class="line">    callImpl([&amp;]() &#123; result = fn(); &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> result = call([]() &#123; <span class="keyword">return</span> sum(<span class="number">1</span>,<span class="number">2</span>); &#125;); <span class="comment">// return int</span></span><br><span class="line"><span class="keyword">auto</span> result = call([]() &#123; <span class="keyword">return</span> sum(<span class="number">1.2</span>,<span class="number">2.3</span>); &#125;); <span class="comment">// return double</span></span><br><span class="line">call([]() &#123; print_line(<span class="string">"called"</span>); &#125;); <span class="comment">// return void</span></span><br></pre></td></tr></table></figure>
<p>以上代码就很完美了，几乎无懈可击。</p>
<p>EOF</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/11/11/cpp-closure/" data-id="cjtctqomf000aufqfpgu7sht6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/闭包/">闭包</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-finite-automaton" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/10/15/finite-automaton/" class="article-date">
  <time datetime="2018-10-15T12:30:48.000Z" itemprop="datePublished">2018-10-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/10/15/finite-automaton/">最简单的计算机之有限自动机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><em>简单是终极的复杂</em> – <em>达 芬奇</em></p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>其实这算是计算理论的第二个章节，第一个章节可以去看我之前写的文章—-<a href="https://alexiachen.github.io/blog/2017/10/15/program-semantic/">《程序的含义》</a>。</p>
<p>追求简单是人类内心的本性使然，看上去好像没有太多修饰，当你仔细揣摩，你会发现，最精华的理论已经融入每个角落，越是简单的东西，其实越难吧空，需要经过千锤百炼。</p>
<p>现代计算机具有强大的计算能力，但是正是由于其强大，所以伴随着过多的复杂性。我们很难理解一台计算机多个子系统的全部细节，更别说理解这些子系统如何互相协作从而构成整个系统了。这些复杂性使得对真实的计算机的能力与行为进行直接推导显得不切实际，此时计算机的简化模型就显得非常有用。简单的模型只提取出真实计算机中令人感兴趣的特性，它可以帮助人们建立对计算完整的认知。</p>
<p>接下来，我们会逐步揭开什么是计算，最后分析这样简单的模型所能达到的计算极限。</p>
<h2 id="确定性有限自动机"><a href="#确定性有限自动机" class="headerlink" title="确定性有限自动机"></a>确定性有限自动机</h2><hr>
<p>现实中，计算机通常有大量的RAM和DISK，还有许多I/O设备（键盘等），还有CPU。有限状态机也被称作有限自动机，这是一个极简的计算机模型。它为了简单，抛弃了RAM DISK等这些特性。</p>
<h3 id="状态-规则-输入-输出"><a href="#状态-规则-输入-输出" class="headerlink" title="状态 规则 输入 输出"></a>状态 规则 输入 输出</h3><p>有限状态机你可以把它看作是一个抽象机器，它拥有一些可能的状态，能跟踪到自己当前具体处于其中的一个状态。注意，它没有键盘等这些接口，它只有一个抽象接口，就是一个来自外部的信息输入流会被它逐个读取，并随着这些信息的输入，自动转移状态。</p>
<p>以下是一个有限状态机的图示：</p>
<p><img src="http://wx2.sinaimg.cn/large/a1ac93f3gy1fwbj5b9ttzj20a305p0sl.jpg" alt=""></p>
<p>至于状态机怎么看，我就不过多介绍了。如果学过《编译原理》的词法分析的章节，一定会接触到的。</p>
<ul>
<li>该机器有两个状态， 1和2</li>
<li>该机器的输入字符集合为{a，b}</li>
<li>该机器的初始状态是1</li>
</ul>
<p>该机器会根据读到的字符来决定转移的状态，它不停的接受a，b在状态1和2之间来回切换，简直没完没了了。它像一个黑盒子一样运行，谁也不知道发生了啥，机器外面没人知道发生了什么，所以机器要有个输出，我们才知道最终的结果，有了结果，机器就停止运行了，相当于这个函数才有了输出，有输入必然要有输出，不然没意义。 所以我们需要为这台机器增加一个终止状态，以表示运行结束，产生输出。</p>
<p>我们暂且把状态2标记为终止状态，当然如果用在词法分析理论上也可以被称为接受状态，表明机器对某个序列是接受还是拒绝。修改好的状态机图示如下：</p>
<p><img src="http://wx4.sinaimg.cn/large/a1ac93f3gy1fwbjpr86a3j209903tq2s.jpg" alt=""></p>
<p>红色就表示终止状态。当然，正规点的自动机终止状态是画两个圆表示终止，我这里图个简便，请谅解下。</p>
<p>好了，我们来分析下。</p>
<p>上图的自动机初始化状态为1, 当读入一个字符a的时候，它会转移到状态2，这是一个终止状态，所以我们可以认为这自动机接受了字符串“a”。如果它又读取了一个字符b，状态又转移到了1,这不是终止状态，所以自动机不接受字符串“ab”，也就是拒绝了“ab”。所以很容易可以推理出来，自动机接受“a”，“aba”，“ababa”这样的字符串。如果把图示下面的字符b也换成a。那么自动机接受“a”，“aaa”，“aaaaa”这样奇数的a组成的字符串，拒绝“”，“aa”，“aaaa”这样偶数个字符a组成的字符串或空字符串。这台自动机就可以判断a组成的字符串是技术还是偶数，是足以称为最简单的计算机了。</p>
<p>当然，我们可以构造更复杂的自动机，我就不打算构造了。</p>
<h3 id="确定性"><a href="#确定性" class="headerlink" title="确定性"></a>确定性</h3><p>显然，如果了解自动机概念的人，就知道之前所提到的自动机都是具有确定性，也就是说，无论它处于什么状态，并且无论读入什么字符，它最终所处的状态总是完全确定的。这样的确定性有2种约束条件：</p>
<ul>
<li><p>不存在二义性，也就是说一个状态对于同样的输入，它不能有多个规则</p>
</li>
<li><p>每个状态都必须针对每个可能的输入字符至少有一个规则</p>
</li>
</ul>
<p>具有这种确定性的自动机专业点叫确定性有限自动机（Deterministic Finite Automaton，DFA）。</p>
<h3 id="用程序语言来实现DFA"><a href="#用程序语言来实现DFA" class="headerlink" title="用程序语言来实现DFA"></a>用程序语言来实现DFA</h3><p>DFA是一种抽象机器，也可以被认为是一种解释器，这种机器很容易用软件来模拟。</p>
<p>首先，需要定义一个规则集合RuleSet。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FARule</span> &lt; Struct.<span class="title">new</span>(:<span class="title">state</span>, :<span class="title">character</span>, :<span class="title">next_state</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">applies_to?</span><span class="params">(state,character)</span></span></span><br><span class="line">    <span class="keyword">self</span>.state == state &amp;&amp; <span class="keyword">self</span>.character == character</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">follow</span></span></span><br><span class="line">    next_state;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inspect</span></span></span><br><span class="line">    <span class="string">"#&lt;FARule <span class="subst">#&#123;state.inspect&#125;</span> --<span class="subst">#&#123;character&#125;</span>--&gt; <span class="subst">#&#123;next_state&#125;</span>&gt;"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DFARuleSet</span> &lt; Struct.<span class="title">new</span>(:<span class="title">rules</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">next_state</span><span class="params">(state,character)</span></span></span><br><span class="line">    rule_for(state,character).follow</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">rule_for</span><span class="params">(state,character)</span></span></span><br><span class="line">    rules.detect &#123; <span class="params">|rule|</span> rule.applies_to?(state,character) &#125; <span class="comment"># find first if</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>每个规则用一个FARule来表示，都有一个applies_to? 这样的API来判断某些输入情况下是否可以apply。DFARuleSet表示规则集合，相当于FARule类的一个容器，存放多个FARule。</p>
<p>好的，现在可以构造一个规则集合了：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">=begin</span></span><br><span class="line"><span class="comment">#&lt;struct DFARuleSet rules=[#&lt;FARule 1 --a--&gt; 2&gt;, #&lt;FARule 1 --b--&gt; 1&gt;, #&lt;FARule 2 --a--&gt; 2&gt;, </span></span><br><span class="line"><span class="comment">#&lt;FARule 2 --b--&gt; 3&gt;, #&lt;FARule 3 --a--&gt; 3&gt;, #&lt;FARule 3 --b--&gt; 3&gt;]&gt;</span></span><br><span class="line"><span class="comment">=end</span></span><br><span class="line">rules = DFARuleSet.new([</span><br><span class="line">  FARule.new(<span class="number">1</span>,<span class="string">'a'</span>,<span class="number">2</span>), FARule.new(<span class="number">1</span>,<span class="string">'b'</span>,<span class="number">1</span>),</span><br><span class="line">  FARule.new(<span class="number">2</span>,<span class="string">'a'</span>,<span class="number">2</span>), FARule.new(<span class="number">2</span>,<span class="string">'b'</span>,<span class="number">3</span>),</span><br><span class="line">  FARule.new(<span class="number">3</span>,<span class="string">'a'</span>,<span class="number">3</span>), FARule.new(<span class="number">3</span>,<span class="string">'b'</span>,<span class="number">3</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试DFARuleSet类</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; 2</span></span><br><span class="line">rules.next_state(<span class="number">1</span>,<span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># =&gt; 1</span></span><br><span class="line">rules.next_state(<span class="number">1</span>,<span class="string">'b'</span>)</span><br><span class="line"><span class="comment"># =&gt; 3</span></span><br><span class="line">rules.next_state(<span class="number">2</span>,<span class="string">'b'</span>)</span><br></pre></td></tr></table></figure>
<p>到这里，是否能根据这个规则集合画出对应的DFA的图呢，这是可以的。下图就是以上RuleSet对应的自动机</p>
<p><img src="http://wx3.sinaimg.cn/large/a1ac93f3gy1fwcprbf862j20ac05f0so.jpg" alt="DFA"></p>
<p>不过，这台自动机没有终止状态，还不完整，所以我们要编写一个DFA的类的表示DFA来配置RuleSet和初始状态，终止状态，加入读取字符流的接口，并模拟抽象机器的运行，这样就灵活了。计算机科学很重要的一点就是抽象思维，分离变化与不变化。是不是跟上一章讲解语义的一样呢？其实都相当于一台解释器。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DFA</span> &lt; Struct.<span class="title">new</span>(:<span class="title">current_state</span>,:<span class="title">final_states</span>,:<span class="title">ruleset</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accepting?</span></span></span><br><span class="line">    final_states.<span class="keyword">include</span>?(current_state)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read_char</span><span class="params">(character)</span></span></span><br><span class="line">    <span class="keyword">self</span>.current_state = ruleset.next_state(current_state,character)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read_string</span><span class="params">(str)</span></span></span><br><span class="line">    str.chars.each <span class="keyword">do</span> <span class="params">|character|</span></span><br><span class="line">      read_char(character)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试下DFA</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">DFA.new(<span class="number">1</span>,[<span class="number">1</span>,<span class="number">3</span>],rules).accepting?</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">DFA.new(<span class="number">1</span>,[<span class="number">3</span>],rules).accepting?</span><br></pre></td></tr></table></figure>
<p>之后，为了更加方便，我们构造一个可以创建DFA的工厂类：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DFAMaker</span> &lt; Struct.<span class="title">new</span>(:<span class="title">start_state</span>, :<span class="title">final_states</span>, :<span class="title">ruleset</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">make_dfa</span></span></span><br><span class="line">    DFA.new(start_state,final_states,ruleset)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accepts?</span><span class="params">(str)</span></span></span><br><span class="line">    make_dfa.tap &#123; <span class="params">|dfa|</span> dfa.read_string(str) &#125;.accepting?</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">3</span>],rules).accepts?(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">3</span>],rules).accepts?(<span class="string">'baa'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">3</span>],rules).accepts?(<span class="string">'babab'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">2</span>],rules).accepts?(<span class="string">'aaaa'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">1</span>],rules).accepts?(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">DFAMaker.new(<span class="number">1</span>,[<span class="number">1</span>],rules).accepts?(<span class="string">'b'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="非确定性有限自动机"><a href="#非确定性有限自动机" class="headerlink" title="非确定性有限自动机"></a>非确定性有限自动机</h2><p>之前的确定性有限自动机（DFA）理解和实现起来都很简单，那是因为DFA与我们熟悉的机器非常相似。</p>
<p>在去除了一台真实的计算机的所有复杂性之后，我们有机会使用一些不太常见的思想去进行探索，这将让我们离本质会更进一步。</p>
<p>一种探索方式是去除我们现在所有的假设和约束。首先，确定性约束似乎是个限制，因为可能我们有些时候并不关系每个状态上每个可能的输入，那么为什么不能忽略不关心的字符处理规则，并假设当异常发生时这台机器能进入到一个通用的失败状态呢？ 那好，我们再进一步放宽要求，如果允许这台自动机拥有对立的规则，那么就会导致机器有多个执行路径，这又意味着什么？</p>
<p>现在我们将要探索这些想法，需要对DFA的能力稍微做调整一下，看看有没有新的可能。</p>
<h3 id="非确定性"><a href="#非确定性" class="headerlink" title="非确定性"></a>非确定性</h3><p>假设我们想要一台自动机，它能接受由a和b组成的第三个字符是b的任意字符串，那么很容易想到以下DFA的图示：</p>
<p><img src="http://wx3.sinaimg.cn/large/a1ac93f3gy1fx90t9coulj20d808rq30.jpg" alt="DFA图示"></p>
<p>以上的DFA处于状态3的时候，一旦读取到b就终止了，如果后面还有输入字符，就不停的循环进入终止状态5，反正目的达到了，只要是第三个字符是b的任意字符串就可以了，但是状态3读到了a字符，那么之后无论遇到什么输入，直到字符流读取完成，字符串也不能被该DFA识别了。</p>
<p>到这里你发现DFA好强大呀，好像没什么不能完成的任务（对于特定字符串识别）。但是你错了，现在我提出一个问题，请设计一台自动机，满足识别倒数第三个字符是b的任意字符串，请问该怎么设计？（这里先别往下看，留一段时间在纸上画画图）。</p>
<p>经过一段时间的思考，有人会发现这似乎会很困难，因为上面的DFA读取正数第三个的字符是b的时候保证在状态3，但是如果是倒数第三个就困难了，自动机很难预先知道什么时候能读到倒数第三，因为在整个字符流读取完成之前它不知道这个字符串有多长。现在我来告诉你，几乎不存在一台DFA能识别这样的需求的字符串。</p>
<p>这时候要加强DFA的能力就需要放宽要求，把它改了，把确定性改成非确定性，换一个概念得了，叫非确定性有限自动机（NFA）。</p>
<p>NFA就是对于每个状态特定的输入结果下，跳转的下一个状态都是不确定的。这个不确定的概念给自动机带来了更加强大的能力。这样就可以很轻松设计以下一台NFA：</p>
<p><img src="http://wx1.sinaimg.cn/large/a1ac93f3gy1fx91nipz96j20bu0553yg.jpg" alt="NFA图示"></p>
<p>查看以上NFA，对于状态1来说，接受一个字符b，它有可能保持在状态1，也可能跳转到状态2。也就是，对于状态1来说，字符b的输入导致的结果是不确定的。</p>
<p>用以上NFA来识别字符串“baa”，读取完字符串之后，最终状态可能停留在状态1，也可能停留在状态4接受态。所以用NFA来识别字符串就要遍历所有可能的状态执行路径，只要存在一种路径能达到终止态，那么该字符串就被这台NFA所接受识别。哈，这么来看有点暴力搜索了，但是没办法，因为我们现实世界的物理计算机就是确定性的计算机，要模拟非确定性只有这样的办法了</p>
<p>这样的暴力方式很容易可以看到两种实现，一个是采用递归，一种是采用线程并行，但是这两种实现都有点复杂和低效。</p>
<p>我们可以采用一种更简洁高效的模拟，模仿DFA的模拟实现。</p>
<p>很简单，最开始与DFA类似，也要创建一个RuleSet来存放规则集合。它与DFA不一样的是，在某个状态时接收相同的输入，可能跳转转移的状态不一致，也就是可能下一个状态是多个可能，所以需要引入编程语言提供的集合（Set）的概念来给下一个状态集去重。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'set'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FARule</span> &lt; Struct.<span class="title">new</span>(:<span class="title">state</span>, :<span class="title">character</span>, :<span class="title">next_state</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">applies_to?</span><span class="params">(state,character)</span></span></span><br><span class="line">    <span class="keyword">self</span>.state == state &amp;&amp; <span class="keyword">self</span>.character == character</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">follow</span></span></span><br><span class="line">    next_state;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inspect</span></span></span><br><span class="line">    <span class="string">"#&lt;FARule <span class="subst">#&#123;state.inspect&#125;</span> --<span class="subst">#&#123;character&#125;</span>--&gt; <span class="subst">#&#123;next_state&#125;</span>&gt;"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NFARuleSet</span> &lt; Struct.<span class="title">new</span>(:<span class="title">rules</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">next_states</span><span class="params">(states, character)</span></span></span><br><span class="line">    states.flat_map &#123; <span class="params">|state|</span> follow_rules_for(state, character) &#125;.to_set</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">follow_rules_for</span><span class="params">(state, character)</span></span></span><br><span class="line">    rules_for(state, character).map(&amp;<span class="symbol">:follow</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">rules_for</span><span class="params">(state, character)</span></span></span><br><span class="line">    rules.select &#123; <span class="params">|rule|</span> rule.applies_to?(state, character) &#125; <span class="comment"># select * where </span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>好的，现在我们来用以上的Ruby类来定义上一副图示所表示的NFA：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ruleset = NFARuleSet.new([</span><br><span class="line">  FARule.new(<span class="number">1</span>, <span class="string">'a'</span>, <span class="number">1</span>), FARule.new(<span class="number">1</span>, <span class="string">'b'</span>, <span class="number">1</span>), FARule.new(<span class="number">1</span>, <span class="string">'b'</span>, <span class="number">2</span>),</span><br><span class="line">  FARule.new(<span class="number">2</span>, <span class="string">'a'</span>, <span class="number">3</span>), FARule.new(<span class="number">2</span>, <span class="string">'b'</span>, <span class="number">3</span>), FARule.new(<span class="number">3</span>, <span class="string">'a'</span>, <span class="number">4</span>),</span><br><span class="line">  FARule.new(<span class="number">3</span>, <span class="string">'b'</span>, <span class="number">4</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; #&lt;Set: &#123;1, 2&#125;&gt;</span></span><br><span class="line">ruleset.next_states(Set[<span class="number">1</span>], <span class="string">'b'</span>)</span><br><span class="line"><span class="comment"># =&gt; #&lt;Set: &#123;1, 3, 4&#125;&gt;</span></span><br><span class="line">ruleset.next_states(Set[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># =&gt; #&lt;Set: &#123;1, 2, 4&#125;&gt;</span></span><br><span class="line">ruleset.next_states(Set[<span class="number">1</span>,<span class="number">3</span>], <span class="string">'b'</span>)</span><br></pre></td></tr></table></figure>
<p>对ruleset的定义能看得出来吗？ next_states的输入参数是当前状态集合，第二个参数是当前状态的输入数据，返回值是接收输入数据后返回的下一个状态集合。</p>
<p>好的，再下一步就是通过程序来模拟手工的NFA运行，与DFA本质上并没有区别：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NFA</span> &lt; Struct.<span class="title">new</span>(:<span class="title">current_states</span>, :<span class="title">final_states</span>, :<span class="title">ruleset</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accepting?</span></span></span><br><span class="line">    (current_states &amp; final_states).any?       <span class="comment"># set intersection operation is empty?</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read_char</span><span class="params">(character)</span></span></span><br><span class="line">    <span class="keyword">self</span>.current_states = ruleset.next_states(current_states,character)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read_string</span><span class="params">(str)</span></span></span><br><span class="line">    str.chars.each <span class="keyword">do</span> <span class="params">|character|</span> </span><br><span class="line">      read_char(character)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NFAMaker</span> &lt; Struct.<span class="title">new</span>(:<span class="title">start_state</span>, :<span class="title">final_states</span>, :<span class="title">ruleset</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">make_nfa</span></span></span><br><span class="line">    NFA.new(Set[start_state], final_states, ruleset)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accepts?</span><span class="params">(str)</span></span></span><br><span class="line">    make_nfa.tap &#123; <span class="params">|nfa|</span> nfa.read_string(str) &#125;.accepting?</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">nfa = NFAMaker.new(<span class="number">1</span>, [<span class="number">4</span>], ruleset)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'bab'</span>)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'bababab'</span>)</span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">nfa.accepts?(<span class="string">'babababa'</span>)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'bababababbbbbb'</span>)</span><br></pre></td></tr></table></figure>
<p>哈哈，以上代码最终实现的效果与NFA的的图示所达到的效果一样了，能接受”bab”，“baa”这样倒数第三个字符是’b’字符的字符串。</p>
<h3 id="自由移动"><a href="#自由移动" class="headerlink" title="自由移动"></a>自由移动</h3><p>上一小节中，我们看到了对确定性这个约束条件的放宽给设计NFA的方法带来了一定的表达能力，为了再次提高表达，是否还可以放松哪些条件呢？</p>
<p>回到DFA的层面，很容易设计一台DFA，这个DFA能接受字符a组成的字符串长度是2的倍数（“aa”, “aaaa”, ……）。</p>
<p><img src="http://wx3.sinaimg.cn/large/a1ac93f3gy1fyuz2lgi1ij20as06t3yg.jpg" alt=""></p>
<p>但是，如何设计一台机器，让这台机器既能接受长度是2的倍数也能接受是3的倍数的字符串呢？ 由于之前了解过NFA的概念，于是有人可能随手就实现了以下一台NFA：</p>
<p><img src="http://wx2.sinaimg.cn/large/a1ac93f3gy1fyuzaqd9o1j20d009ymxc.jpg" alt=""></p>
<p>以上这台NFA确实能接受”aa” “aaaa” “aaa” “aaaaaa”这样的字符串，满足要求。但是仔细一看，其实它也能接受”aaaaa” 这样不满足设计要求的字符串。我靠，不符合设计啊。如果不经过严密思考，一旦NFA比较复杂，那么这种错误一般比较难发现。怎么办呢？</p>
<p>其实已经很接近真相了，最主要是因为这一台NFA要满足2个条件，这两个条件写在一起了，其实我们可以把这两个条件，根据每个条件写出对应的DFA，然后把DFA组合在一起形成一个规模大点的NFA机器。</p>
<p>我们把这种组合特性叫做自由移动，这个特性就是能让NFA在多组状态中做选择的。我们把自由移动这种特性用没有转移输入的箭头来表示：</p>
<p><img src="http://wx4.sinaimg.cn/large/a1ac93f3gy1fyuzs6tzkcj20fp0dtmxj.jpg" alt=""></p>
<p>上面这台NFA，但如果在当前是状态1。那么它的当前状态就既是2也是4的状态。也就是说，这台NFA的初始状态集合是[1,2,4]。状态1流转只能到2或4，这样就分叉了，根据箭头是回不去状态1的，这样2台DFA各司其职。</p>
<p>那么如果用Ruby怎么模拟NFA中的自由移动呢？ 其实就在RuleSet的规则集合中定义一个无输入并且自由流转的规则。 好的，我们根据这点来根据上图所示的NFA，设置它的规则：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ruleset = NFARuleSet.new([</span><br><span class="line">  FARule.new(<span class="number">1</span>, <span class="literal">nil</span>, <span class="number">2</span>), FARule.new(<span class="number">1</span>, <span class="literal">nil</span>, <span class="number">4</span>), </span><br><span class="line">  FARule.new(<span class="number">2</span>, <span class="string">'a'</span>, <span class="number">3</span>),</span><br><span class="line">  FARule.new(<span class="number">3</span>, <span class="string">'a'</span>, <span class="number">2</span>), </span><br><span class="line">  FARule.new(<span class="number">4</span>, <span class="string">'a'</span>, <span class="number">5</span>), </span><br><span class="line">  FARule.new(<span class="number">5</span>, <span class="string">'a'</span>, <span class="number">6</span>),</span><br><span class="line">  FARule.new(<span class="number">6</span>, <span class="string">'a'</span>, <span class="number">4</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt; #&lt;Set: &#123;2, 4&#125;&gt;</span></span><br><span class="line">ruleset.next_states(Set[<span class="number">1</span>], <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<p>状态1在无输入的情况下的下一个状态集合就是[2,4]。然后需要在RulSet的类中添加一个方法来计算一个状态集合的自由移动，这个方法同样返回一个状态集合：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NFARuleSet</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">follow_free_moves</span><span class="params">(states)</span></span></span><br><span class="line">    more_states = next_states(states, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> more_states.subset?(states)</span><br><span class="line">      states</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      follow_free_moves(states + more_states)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =&gt;  #&lt;Set: &#123;1, 2, 4&#125;&gt;</span></span><br><span class="line">ruleset.follow_free_moves(Set[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>然后，要模拟当前状态的自由移动，重写NFA类中的current_states：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NFA</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">current_states</span></span></span><br><span class="line">    ruleset.follow_free_moves(<span class="keyword">super</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>这样的意图是，确保NFA当前可能的状态总是通过自由移动流转到任何可能的状态。这就让访问当前状态透明了，之前的代码几乎不用改动。好了，现在可以用之前的NFAMaker构造出一个支持自由移动的NFA了，并且按照上图的NFA设计图，并确保代码可以正确工作了：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nfa = NFAMaker.new(<span class="number">1</span>, [<span class="number">2</span>, <span class="number">4</span>], ruleset)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'aa'</span>)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'aaa'</span>)</span><br><span class="line"><span class="comment"># =&gt; false</span></span><br><span class="line">nfa.accepts?(<span class="string">'aaaaa'</span>)</span><br><span class="line"><span class="comment"># =&gt; true</span></span><br><span class="line">nfa.accepts?(<span class="string">'aaaaaa'</span>)</span><br></pre></td></tr></table></figure>
<p>看运行结果，恩，与设想中的一样。能接受2或3的倍数，并且不会出错了。</p>
<p>模拟自由移动比现象中简单，它在非确定的基础上给了设计者额外的设计自由。当然从自动机理论的角度看，这文章中的很多名词并不专业，有限自动机读取的字符一般叫符号（Symbol），状态之间移动的规则叫做转移（transition），组成一台机器的规则集合叫做转移函数,表示空字符串的数学符号是希腊字母ε，能自由移动的NFA称为NFA-ε，自由移动一般叫ε转移。</p>
<p>如果你学过编译原理的国外教材，在讲状态机的时候就会接触到这些，比如把正则表达式通过NFA写出来，就会用到ε转移来组合各种状态机，然后通过子集构造法把NFA规约成DFA。 后面我会讲到有限状态机与正则表达式是等价的，相当与正则表达式是有限自动机的文本表示出来的语言（正则语言，有时候也叫正规语言），而有限状态机是正则语言的解释器。所以当你想从底层实现正则表达式引擎的话，无论如何也绕不过有限状态机理论的。当然有些高级做法，并没有把正则表达式翻译成自动机执行，但是我这里不想过多涉及这样工业界的高级解释器技巧，这已经偏离文章宗旨。</p>
<h2 id="正则语言"><a href="#正则语言" class="headerlink" title="正则语言"></a>正则语言</h2><p>正则语言也叫正则表达式，这是一个很简单的语言，正因为太简单了，所以在表达一些复杂模式匹配的时候语言会有些晦涩。但是它的单个规则很简单，都是通过简单的规则组合起来用的。这个子章节，我需要用Ruby构造的NFA一步一步来构建最简单的正则表达式的解释器。</p>
<p>（To be contined）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/10/15/finite-automaton/" data-id="cjtctqopf008jufqfxrz5at4u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/有限自动机/">有限自动机</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/程序语言理论/">程序语言理论</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/计算理论/">计算理论</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-manjaro-mysql8-conf" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/08/25/manjaro-mysql8-conf/" class="article-date">
  <time datetime="2018-08-25T06:13:47.000Z" itemprop="datePublished">2018-08-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/08/25/manjaro-mysql8-conf/">manjaro下安装配置MySQL8</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>虽然Arch体系的Linux都推荐用MariaDB，也不知道为什么Arch Linux不大推荐MySQL，虽然二者协议兼容，但是我就想用MySQL。</p>
<p>我这边是中科大的源。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S mysql</span><br><span class="line">sudo mysqld --initialize --user=mysql --basedir=/usr --datadir=/var/lib/mysql</span><br></pre></td></tr></table></figure>
<p>如果成功，terminal会出现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2018-08-25T05:33:04.399546Z 0 [Warning] [MY-010915] [Server] &apos;NO_ZERO_DATE&apos;, &apos;NO_ZERO_IN_DATE&apos; and &apos;ERROR_FOR_DIVISION_BY_ZERO&apos; sql modes should be used with strict mode. They will be merged with strict mode in a future release.</span><br><span class="line"></span><br><span class="line">2018-08-25T05:33:04.399603Z 0 [System] [MY-013169] [Server] /usr/bin/mysqld (mysqld 8.0.12) initializing of server in progress as process 20610</span><br><span class="line"></span><br><span class="line">2018-08-25T05:33:40.201045Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: 56%ei0#nQ:/;</span><br><span class="line"></span><br><span class="line">2018-08-25T05:34:11.553951Z 0 [System] [MY-013170] [Server] /usr/bin/mysqld (mysqld 8.0.12) initializing of server has completed</span><br></pre></td></tr></table></figure>
<p>临时产生了一个root用户的密码，需要登录进去重新更改才可以操作数据库。</p>
<p>先启动mysql服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start mysqld</span><br></pre></td></tr></table></figure>
<p>然后登录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p[temp_password]</span><br></pre></td></tr></table></figure>
<p>更改root临时密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ALTER user <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'new_password'</span>;</span><br></pre></td></tr></table></figure>
<p>然后就可以各种命令了, 建库，建用户，授权等等:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create database [new_db_name];</span><br><span class="line"></span><br><span class="line">create user <span class="string">'new_user_name'</span>@<span class="string">'localhost'</span> identified by <span class="string">'user_password'</span>;</span><br><span class="line"></span><br><span class="line">use [db_name];</span><br><span class="line"></span><br><span class="line">grant all privileges on [db_name].* to <span class="string">'[user_name]'</span>@<span class="string">'localhost'</span> with grant option;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<p>EOF</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/08/25/manjaro-mysql8-conf/" data-id="cjtctqomy0019ufqfsfw6dabq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/MySQL/">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cmake-tutorial" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/08/12/cmake-tutorial/" class="article-date">
  <time datetime="2018-08-12T09:39:00.000Z" itemprop="datePublished">2018-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/08/12/cmake-tutorial/">简短的CMake教程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>主要最近的换工作，完全在Linux下开发，虽然以前都接触过CMake，不过体系也是零散的，遂做了一个简短的CMake教程，以供后续快速入门。</p>
<p>另外，好久也没有写文章了，这份工作还是有一定的技术性，之前的那家公司是开发/维护，大部分工作都是维护，没有什么写文章的激情。</p>
<p>所以，今天是硬凑一篇文章。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><hr>
<h4 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h4><p>CMake是跨平台的元构建系统，也就是说，它不实际产生构建行为，它只是生成给其他构建系统使用的文件，比如Makefile，MSBuild的solution file。</p>
<p>CMake根据读取名为CMakeLists.txt的文件，然后生成平台特定的构建文件，但是一个很大的问题是，CMake官方提供的教程特别复杂，对于新手的个坑，很难快速入门。</p>
<p>这个教程会通过例子来学习怎么用CMake。以下我们提供几个C++源代码供例子使用：</p>
<ul>
<li>main.cpp</li>
<li>vector.h</li>
<li>vector.cpp</li>
<li>array.h</li>
<li>array.cpp</li>
</ul>
<p>那么描述构建的CMakeLists.txt内容会是以下:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</span><br><span class="line"><span class="keyword">project</span>(pjc-lab5)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-std=c++14 -Wall $&#123;CMAKE_CXX_FLAGS&#125;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(vector-<span class="keyword">test</span></span><br><span class="line">    array.cpp</span><br><span class="line">    vector.cpp</span><br><span class="line">    main.cpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>以上代码很简单，但是第一个问题是，它是不可移植的，因为它没有任何逻辑判断就设置了GCC/Clang的特定编译参数。</p>
<p>第二个问题是，它全局改变了include的搜索路径。</p>
<p>CMake也要有好的书写习惯，采用更加现代的方式来写CMake文件:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span>)</span><br><span class="line"><span class="keyword">project</span>(pjc-lab5 LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">14</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(vector-<span class="keyword">test</span></span><br><span class="line">    array.cpp</span><br><span class="line">    vector.cpp</span><br><span class="line">    main.cpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>注意了，以上代码有几点改变了：</p>
<ul>
<li>强制要求了CMake的版本不得小于3.5，因为要使用CMake的一些新功能</li>
<li>直接指定该工程为C++工程。这样可以减少CMake查找tool chain的时间，它就不会去查找其他编译器了，也不会检查其他编译器是否正常了。</li>
<li>直接采用可跨平台的方式来指定采用的C++标准为C++ 14</li>
<li>打开CMAKE_CXX_STANDARD_REQUIRED开关，如果C++ 14标准不被支持，CMake会直接终止构建过程。反之，会采用老的标准来构建</li>
<li>CMAKE_CXX_EXTENSIONS开关是告诉CMake采用更加通用的编译参数，比如这个开关打开，传递给GCC的参数就会是-std=c++14 而不是-std=gnu++14</li>
</ul>
<p>然后在构建过程中，你会发现没有警告，因为CMake不会设定编译器的警告级别，需要你根据不同平台来指定相应的编译器警告参数:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"Clang|AppleClang|GNU"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE -Wall -Wextra -Wunreachable-code -Wpedantic)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"Clang"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE -Wweak-vtables -Wexit-time-destructors -Wglobal-constructors -Wmissing-noreturn )</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"MSVC"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE /W4 /w44265 /w44061 /w44062 )</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<p>如果就采用上述的CMake文件，那么它生成的工程文件并不好，没有预期，你会发现如果生成VS的solution，你打开工程，你会发现没有包含头文件（vector.h array.h）。因为CMake不理解C++语言，它只是构建工具。</p>
<p>所以CMake文件中要改变下:<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(vector-<span class="keyword">test</span></span><br><span class="line">    array.cpp</span><br><span class="line">    vector.cpp</span><br><span class="line">    main.cpp</span><br><span class="line">    array.h</span><br><span class="line">    vector.h</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>当然，也可以通过CMake的source_group命令给文件归类:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source_group</span>(<span class="string">"Tests"</span> FILES main.cpp)</span><br><span class="line"><span class="keyword">source_group</span>(<span class="string">"Implementation"</span> FILES array.cpp vector.cpp)</span><br></pre></td></tr></table></figure>
<p>这样VS工程下就可以看到对C++源文件分类的文件夹图标了。</p>
<h4 id="Tests"><a href="#Tests" class="headerlink" title="Tests"></a>Tests</h4><p>CMake是一堆工具的集合，所以它有一个test runner，叫<a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html" target="_blank" rel="noopener">CTest</a>。</p>
<p>要使用它，你需要显式指定它：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_test</span>(NAME <span class="keyword">test</span>-name <span class="keyword">COMMAND</span> how-to-run-it)</span><br></pre></td></tr></table></figure></p>
<p>测试返回0表示成功，返回其他值表示失败。</p>
<p>还可以自定义，通过<a href="https://cmake.org/cmake/help/latest/command/set_tests_properties.html?highlight=set_tests_properties" target="_blank" rel="noopener">set_tests_properties</a>来设置其<a href="https://cmake.org/cmake/help/v3.11/manual/cmake-properties.7.html#test-properties" target="_blank" rel="noopener">相关属性</a>。</p>
<p>对于我们的例子工程，我们仅仅是运行bin文件，并不做额外检查:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CTest)</span><br><span class="line"><span class="keyword">add_test</span>(NAME plain-run <span class="keyword">COMMAND</span> $&lt;TARGET_FILE:vector-<span class="keyword">test</span>&gt;)</span><br></pre></td></tr></table></figure>
<p>COMMAND后面的表达式是<a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html" target="_blank" rel="noopener">generator-expression</a>。</p>
<p>最后，我们的CMakeLists.txt的内容会是:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span>)</span><br><span class="line"><span class="keyword">project</span>(pjc-lab5 </span><br><span class="line">DESCRIPTION <span class="string">"Very nice project"</span></span><br><span class="line">LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">14</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(vector-<span class="keyword">test</span></span><br><span class="line">    array.cpp</span><br><span class="line">    vector.cpp</span><br><span class="line">    main.cpp</span><br><span class="line">    array.h</span><br><span class="line">    vector.h</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">source_group</span>(<span class="string">"Tests"</span> FILES main.cpp)</span><br><span class="line"><span class="keyword">source_group</span>(<span class="string">"Implementation"</span> FILES array.cpp vector.cpp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"Clang|AppleClang|GNU"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE -Wall -Wextra -Wunreachable-code -Wpedantic)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"Clang"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE -Wweak-vtables -Wexit-time-destructors -Wglobal-constructors -Wmissing-noreturn )</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">if</span> ( CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">"MSVC"</span> )</span><br><span class="line">    <span class="keyword">target_compile_options</span>( vector-<span class="keyword">test</span> PRIVATE /W4 /w44265 /w44061 /w44062 )</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(CTest)</span><br><span class="line"><span class="keyword">add_test</span>(NAME plain-run <span class="keyword">COMMAND</span> $&lt;TARGET_FILE:vector-<span class="keyword">test</span>&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="libraries"><a href="#libraries" class="headerlink" title="libraries"></a>libraries</h4><p>之前的教程都是很简单的例子，但是现实中的项目往往要拆分模块，链接外部的第三方库或者链接工程内的库。</p>
<p>如果不想阅读此章节，可以参考JetBrain的CLion提供的一个简明的<a href="https://www.jetbrains.com/help/clion/quick-cmake-tutorial.html" target="_blank" rel="noopener">CMake教程</a>。</p>
<p>里面记录如何包含链接外部的library。</p>
<p>构建生成一个library的cmake指令如下:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(libname [STATIC | SHARED] two.cpp three.h)</span><br></pre></td></tr></table></figure>
<p>下面我们来写一个计算器程序的cmake,bin文件依赖了lib文件，这样看起来就像一个小工程了:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(Calculator LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(calclib STATIC src/calclib.cpp <span class="keyword">include</span>/calc/lib.hpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(calclib PUBLIC <span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">target_compile_features</span>(calclib PUBLIC cxx_std_11)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(calc apps/calc.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(calc PUBLIC calclib)</span><br></pre></td></tr></table></figure>
<h4 id="变量和缓存变量"><a href="#变量和缓存变量" class="headerlink" title="变量和缓存变量"></a>变量和缓存变量</h4><p>为什么要说这个？因为如果cmake维护一个很大的工程，会有各种编译策略参数，这个就需要逻辑判断，变量这些就随之诞生了。</p>
<p>给一个局部变量设置一个值:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_VARIABLE <span class="string">"value"</span>)</span><br></pre></td></tr></table></figure>
<p>当然，cmake也有list类型的变量,有2种表达方式：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST <span class="string">"one"</span> <span class="string">"two"</span>)</span><br><span class="line"><span class="keyword">set</span>(MY_LIST <span class="string">"one;two"</span>)</span><br></pre></td></tr></table></figure>
<p>以上变量如果离开作用域就无效了。</p>
<p>下面来说下缓存变量，如果你要从命令行来设置cmake的变量，那么就需要声明缓存变量。类似于CMAKE_BUILD_TYPE这样的变量都是缓存变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_CACHE_VARIABLE <span class="string">"VALUE"</span> CACHE <span class="keyword">STRING</span> <span class="string">"Description"</span>)</span><br></pre></td></tr></table></figure>
<p>但是以上不会替换已经存在的值，需要按照以下这样：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_CACHE_VARIABLE <span class="string">"VALUE"</span> CACHE <span class="keyword">STRING</span> <span class="string">""</span> FORCE)</span><br><span class="line"><span class="keyword">mark_as_advanced</span>(MY_CACHE_VARIABLE)</span><br></pre></td></tr></table></figure>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>cmake可以访问环境变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;variable_name&#125; value)</span><br><span class="line"><span class="keyword">set</span>(MY_VAR $ENV&#123;variable_name&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>cmake也会在属性中保存一些信息，这些属性有点像变量，但是这些属性的作用一般是针对一个target或者目录什么的。cmake的属性变量是以CMAKE_打头的，类似CMAKE_BUILD_TYPE，CMAKE_CXX_STANDARD这些。</p>
<p>比如使用CXX标准可以用设置属性的方式办到，有两种表达：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_property</span>(<span class="keyword">TARGET</span> TargetName</span><br><span class="line">             PROPERTY CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_target_properties</span>(TargetName PROPERTIES</span><br><span class="line">                      CXX_STANDARD <span class="number">11</span>)</span><br></pre></td></tr></table></figure>
<p>当然既然有set，当然有get:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_property</span>(ResultVariable <span class="keyword">TARGET</span> TargetName PROPERTY CXX_STANDARD)</span><br></pre></td></tr></table></figure>
<h3 id="Cmake编程"><a href="#Cmake编程" class="headerlink" title="Cmake编程"></a>Cmake编程</h3><h4 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(variable)</span><br><span class="line">    <span class="comment"># If variable is `ON`, `YES`, `TRUE`, `Y`, or non zero number</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="comment"># If variable is `0`, `OFF`, `NO`, `FALSE`, `N`, `IGNORE`, `NOTFOUND`, `""`, or ends in `-NOTFOUND`</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">"$&#123;variable&#125;"</span>)</span><br><span class="line">    <span class="comment"># True if variable is not false-like</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="comment"># Note that undefined variables would be `""` thus false</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<h4 id="宏和函数"><a href="#宏和函数" class="headerlink" title="宏和函数"></a>宏和函数</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(SIMPLE REQUIRED_ARG)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">"Simple arguments: $&#123;REQUIRED_ARG&#125;, followed by $&#123;ARGV&#125;"</span>)</span><br><span class="line">    <span class="keyword">set</span>(<span class="variable">$&#123;REQUIRED_ARG&#125;</span> <span class="string">"From SIMPLE"</span> PARENT_SCOPE)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">simple(This)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">"Output: $&#123;This&#125;"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="与源码文件“通信”"><a href="#与源码文件“通信”" class="headerlink" title="与源码文件“通信”"></a>与源码文件“通信”</h4><p>Cmake允许源代码访问cmake的变量，这个指令就是configure_file。</p>
<p>这样的功能在版本管理上经常使用：</p>
<p>Version.h.in<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION_MAJOR @PROJECT_VERSION_MAJOR@</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION_MINOR @PROJECT_VERSION_MINOR@</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION_PATCH @PROJECT_VERSION_PATCH@</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION_TWEAK @PROJECT_VERSION_TWEAK@</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_VERSION <span class="meta-string">"@PROJECT_VERSION@"</span></span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">configure_file</span> (</span><br><span class="line">    <span class="string">"$&#123;PROJECT_SOURCE_DIR&#125;/include/My/Version.h.in"</span></span><br><span class="line">    <span class="string">"$&#123;PROJECT_BINARY_DIR&#125;/include/My/Version.h"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>可以从上面的配置看出来，本质上cmake只是把后缀in的文件，进行变量标记替换，然后再拷贝到指定目录的文件名。没有什么神奇的。</p>
<p>当然，cmake也可以反过来，cmake代码访问源码文件的内容：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Assuming the canonical version is listed in a single line</span></span><br><span class="line"><span class="comment"># This would be in several parts if picking up from MAJOR, MINOR, etc.</span></span><br><span class="line"><span class="keyword">set</span>(VERSION_REGEX <span class="string">"#define MY_VERSION[ \t]+\"(.+)\""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read in the line containing the version</span></span><br><span class="line"><span class="keyword">file</span>(STRINGS <span class="string">"$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include/My/Version.hpp"</span></span><br><span class="line">    VERSION_STRING REGEX <span class="variable">$&#123;VERSION_REGEX&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pick out just the version</span></span><br><span class="line"><span class="keyword">string</span>(REGEX REPLACE <span class="variable">$&#123;VERSION_REGEX&#125;</span> <span class="string">"\\1"</span> VERSION_STRING <span class="string">"$&#123;VERSION_STRING&#125;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatically getting PROJECT_VERSION_MAJOR, My_VERSION_MAJOR, etc.</span></span><br><span class="line"><span class="keyword">project</span>(My LANGUAGES CXX VERSION <span class="variable">$&#123;VERSION_STRING&#125;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="怎样规划你的工程结构"><a href="#怎样规划你的工程结构" class="headerlink" title="怎样规划你的工程结构"></a>怎样规划你的工程结构</h3><p>基本如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- project</span><br><span class="line">  - .gitignore</span><br><span class="line">  - README.md</span><br><span class="line">  - LICENCE.md</span><br><span class="line">  - CMakeLists.txt</span><br><span class="line">  - cmake</span><br><span class="line">    - FindSomeLib.cmake</span><br><span class="line">  - include</span><br><span class="line">    - project</span><br><span class="line">      - lib.hpp</span><br><span class="line">  - src</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">    - lib.cpp</span><br><span class="line">  - apps</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">    - app.cpp</span><br><span class="line">  - tests</span><br><span class="line">    - testlib.cpp</span><br><span class="line">  - docs</span><br><span class="line">    - Doxyfile.in</span><br><span class="line">  - extern</span><br><span class="line">    - googletest</span><br><span class="line">  - scripts</span><br><span class="line">    - helper.py</span><br></pre></td></tr></table></figure>
<h3 id="运行其他的程序"><a href="#运行其他的程序" class="headerlink" title="运行其他的程序"></a>运行其他的程序</h3><p>编译的时候要做很多事情，比如你构建完毕要用nsis进行打包等等，有些时候不得不调用其他命令行。</p>
<h4 id="配置时运行一个命令"><a href="#配置时运行一个命令" class="headerlink" title="配置时运行一个命令"></a>配置时运行一个命令</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Git QUIET)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(GIT_FOUND <span class="keyword">AND</span> <span class="keyword">EXISTS</span> <span class="string">"$&#123;PROJECT_SOURCE_DIR&#125;/.git"</span>)</span><br><span class="line">    <span class="keyword">execute_process</span>(<span class="keyword">COMMAND</span> <span class="variable">$&#123;GIT_EXECUTABLE&#125;</span> submodule update --init --recursive</span><br><span class="line">                    WORKING_DIRECTORY <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span></span><br><span class="line">                    RESULT_VARIABLE GIT_SUBMOD_RESULT)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> GIT_SUBMOD_RESULT <span class="keyword">EQUAL</span> <span class="string">"0"</span>)</span><br><span class="line">        <span class="keyword">message</span>(FATAL_ERROR <span class="string">"git submodule update --init failed with $&#123;GIT_SUBMOD_RESULT&#125;, please checkout submodules"</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<h4 id="编译时运行一个命令"><a href="#编译时运行一个命令" class="headerlink" title="编译时运行一个命令"></a>编译时运行一个命令</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(PythonInterp REQUIRED)</span><br><span class="line"><span class="keyword">add_custom_command</span>(OUTPUT <span class="string">"$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/include/Generated.hpp"</span></span><br><span class="line">    <span class="keyword">COMMAND</span> <span class="string">"$&#123;PYTHON_EXECUTABLE&#125;"</span> <span class="string">"$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/scripts/GenerateHeader.py"</span> --argument</span><br><span class="line">    DEPENDS some_target)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_custom_target</span>(generate_header ALL</span><br><span class="line">    DEPENDS <span class="string">"$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/include/Generated.hpp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(FILES <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/<span class="keyword">include</span>/Generated.hpp DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Cmake其他的一些特性"><a href="#Cmake其他的一些特性" class="headerlink" title="Cmake其他的一些特性"></a>Cmake其他的一些特性</h3><p>CMAKE_BUILD_TYPE变量默认既不是Debug也不是Release。必须指定。</p>
<p>关于C++ 11等一些新标准，有以下配置:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_target_properties</span>(myTarget PROPERTIES</span><br><span class="line">    CXX_STANDARD <span class="number">11</span></span><br><span class="line">    CXX_STANDARD_REQUIRED YES</span><br><span class="line">    CXX_EXTENSIONS NO</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="查找库"><a href="#查找库" class="headerlink" title="查找库"></a>查找库</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_library</span>(MATH_LIBRARY m)</span><br><span class="line"><span class="keyword">if</span>(MATH_LIBRARY)</span><br><span class="line">    <span class="keyword">target_link_libraries</span>(MyTarget PUBLIC <span class="variable">$&#123;MATH_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/08/12/cmake-tutorial/" data-id="cjtctqoop006vufqffm5la8a2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/CMake/">CMake</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-manjaro-hello" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/08/11/manjaro-hello/" class="article-date">
  <time datetime="2018-08-11T01:00:00.000Z" itemprop="datePublished">2018-08-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/08/11/manjaro-hello/">你好，manjaro</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><em>青葱岁月，一去不复返啊</em></p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>对于Linux呢，我自己算不上熟悉，但也不是很陌生。大一上学期的时候在对于操作系统什么都不懂的情况下，废了九牛二虎之力装了个ubuntu。随便敲了下命令行，于是便草草了事。</p>
<p>工作了以后，使用的开发环境windows和Linux都接触过，不过对于windows接触的是最多的。因为大学主要业余写的是win32的代码。工作的时候呢，如果遇到程序需要运行在Linux上，大部分的时候是在windows上用IDE写好代码，然后配置好<a href="https://cmake.org/" target="_blank" rel="noopener">cmake</a>,然后cmake生成Linux下的GNU Makefile文件，就可以make工程了。因为工作的稳定需要，接触最多的Linux发行版是CentOS，RedHat，ubuntu，当然还有Fedora和OpenSUSE。</p>
<p>所以对于Linux说实话，还是没有依赖得过多，它对于我来说，不过就是个工具。我没有像其他人那样对某个发行版的热爱上升到信仰程度。但是由于网络上某些人的安利，曾经试着装过具有高度自由，高度灵活的Linux发行版—<a href="https://www.archlinux.org/" target="_blank" rel="noopener">Arch Linux</a>。</p>
<p>当然，对于刚开始接触Arch的我，完全通过命令行安装Arch的过程，还是把我折腾的够呛，不过最后还是装上了。之后，在上面写了个hello world就把Arch卸载了。没用过Arch社区提供的<a href="https://wiki.archlinux.org/index.php/Pacman" target="_blank" rel="noopener">pacman</a>和<a href="https://aur.archlinux.org/" target="_blank" rel="noopener">AUR</a>。</p>
<p>但是最近工作的原因，需要完全在Linux下工作更加方便，所以把家里这台个人电脑的windows全部格了，因为考虑到我这台电脑性能的问题，没有装<a href="https://www.deepin.org/" target="_blank" rel="noopener">Deepin Linux</a>，Deepin UI太炫了，占用资源高，听社区反映有些时候桌面环境会卡死，于是索性就装了个<a href="https://manjaro.org/" target="_blank" rel="noopener">manjaro Linux</a>。</p>
<p>选择manjaro的几个原因如下：</p>
<ul>
<li><p>Arch的衍生版，继承自Arch几乎所有优点（软件源更新非常快，软件时常保持最新，内核滚动升级，利用AUR和pacman的包管理）。</p>
</li>
<li><p>图形化的安装界面，一路Next，几乎开箱即用。</p>
</li>
<li><p>硬件支持非常好。</p>
</li>
<li><p>高度可定制化，而且Xfce的DE，资源占用低。</p>
</li>
</ul>
<h2 id="折腾手记"><a href="#折腾手记" class="headerlink" title="折腾手记"></a>折腾手记</h2><hr>
<h4 id="更新系统"><a href="#更新系统" class="headerlink" title="更新系统"></a>更新系统</h4><p>因为manjaro是滚动发布的，所以安装完成重启后，进入系统第一件事情最好是打开terminal，运行以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syu</span><br></pre></td></tr></table></figure>
<p>目的是更新本地的源数据库和更新系统。不然如果长时间不升级系统，容易滚挂掉。不过听说manjaro对于Arch很少发生这种意外，非常稳定。</p>
<h4 id="通过NTP服务设置当前系统时间"><a href="#通过NTP服务设置当前系统时间" class="headerlink" title="通过NTP服务设置当前系统时间"></a>通过NTP服务设置当前系统时间</h4><p>安装完成的系统跟当前时区的时间不同步，采用NTP协议来同步时间:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ntpdate cn.ntp.org.cn <span class="comment">#可以换成任何一个公开的NTP Server地址</span></span><br></pre></td></tr></table></figure>
<h4 id="安装yaourt"><a href="#安装yaourt" class="headerlink" title="安装yaourt"></a>安装yaourt</h4><p>yaourt是pacman的一个外壳，同时它还支持AUR。AUR是一个Arch Linux用户的软件仓库，也就是说，很多用户可以把自己喜欢的软件包上传上去，分享给其他用户。我们在AUR里面搜索得到的软件，可以通过yaourt来简化安装流程。</p>
<p>如果不用yaourt，你恐怕得手动编译软件的很多东西，要多敲十几个命令行，不划算。yaourt这些步骤都对用户透明化了。方便不少。不过这里提示一点，AUR里面的软件毕竟是野生的，没有经过完全测试，没有官方源提供的安全，所以有一定风险，安装一个软件前，需要仔细评估，查看用户评论。但是Arch软件巨多，就是强大在AUR上面了。</p>
<p>运行一下命令就安装yaourt了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S yaourt</span><br></pre></td></tr></table></figure>
<p>之后你就可以通过以下命令搜索AUR上的软件了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -Ss [package name]</span><br></pre></td></tr></table></figure>
<h4 id="安装Visual-Studio-Code"><a href="#安装Visual-Studio-Code" class="headerlink" title="安装Visual Studio Code"></a>安装Visual Studio Code</h4><p>毕竟我是微软的粉丝，最近几年微软大力支持开源。VSCode真是良心的开源跨平台的编辑器产品，获得网络上的一致好评，在windiws下用它也用的多。反正Linux下的vi vim nano这些用得不顺手，也不熟悉。</p>
<p>直接用yaourt安装VSCode:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -S visual-studio-code-bin</span><br></pre></td></tr></table></figure>
<h4 id="安装中文输入法"><a href="#安装中文输入法" class="headerlink" title="安装中文输入法"></a>安装中文输入法</h4><p>然后就是安装中文输入法–搜狗输入法。Deepin自带了，毕竟国产Linux。但是manjaro可没这么好。</p>
<ol>
<li>首先添加国内源</li>
</ol>
<p>打开/etc/pacman.conf配置文件。并在文件末尾添加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[archlinuxcn]</span><br><span class="line">SigLevel = Optional TrustedOnly</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>更新源并导入GPG Key</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>安装搜狗输入法</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx-im <span class="comment">#默认全部安装</span></span><br><span class="line">sudo pacman -S fcitx-configtool <span class="comment"># 图形化配置工具</span></span><br><span class="line">sudo pacman -S fcitx-sogoupinyin</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>编辑添加输入法配置文件</li>
</ol>
<p>生成并编辑~/.xprofile文件，添加以下内容:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=<span class="string">"@im=fcitx"</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>重启系统，使输入法安装生效</li>
<li>通过fcitx-configtool配置工具添加搜狗输入法</li>
<li>完成</li>
</ol>
<h4 id="安装CLion"><a href="#安装CLion" class="headerlink" title="安装CLion"></a>安装CLion</h4><p>喜欢JetBrain系列的IDE，没有IDE简直没法干活，windows上当然是Visual Studio，但是Linux上只能是CLion了。当然，感受了下，它同样强大，作为Linux下的C++ IDE，它够用了，支持CMake工程模型。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yaourt -S clion</span><br><span class="line">sudo yaourt -S clion-cmake</span><br><span class="line">sudo yaourt -S clion-gdb</span><br><span class="line">sudo yaourt -S clion-jre</span><br></pre></td></tr></table></figure>
<h4 id="安装Adobe-Flash-Player-Plugin"><a href="#安装Adobe-Flash-Player-Plugin" class="headerlink" title="安装Adobe Flash Player Plugin"></a>安装Adobe Flash Player Plugin</h4><p>这样最起码可以看bilibili了，= =。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S flashplugin</span><br></pre></td></tr></table></figure>
<h4 id="安装迅雷"><a href="#安装迅雷" class="headerlink" title="安装迅雷"></a>安装迅雷</h4><p>我发现Linux下的aria2这个下载神器堪比迅雷，我下载aria2，并配置了aria2.conf中的tracker，还是不行，下载几乎没啥速度。而且aria2也不支持ed2k。而在Linux上支持ed2k的amule客户端下载速度也是以0计算。太烂了，也许不能开箱即用吧。</p>
<p>想想还是迅雷好，国产Deepin已经通过deepin-wine已经完美移植迅雷过来了。所以我们安装下就可以了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S deepin-wine</span><br><span class="line">sudo pacman -S deepin.com.thunderspeed</span><br></pre></td></tr></table></figure>
<p>这里我感谢武汉深之度的程序员日日夜夜的努力，这种造福人类的事情值得表扬。当然安装上迅雷有点BUG，就是中文字符显示不出来。我只能猜着点击按钮下载，不过好在界面布局我比较熟悉，下载没出啥意外。电影天堂的大部分ftp电影都能下载下来。</p>
<h4 id="影音娱乐"><a href="#影音娱乐" class="headerlink" title="影音娱乐"></a>影音娱乐</h4><p>音乐就听听网易云的Web版本了。电影的话，manjaro自带VLC，这个极度强大，但是界面不好看。把它卸载了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Rss vlc</span><br></pre></td></tr></table></figure>
<p>换了deepin出品的deepin-movie。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S deepin-movie</span><br></pre></td></tr></table></figure>
<h4 id="推荐些命令行神器"><a href="#推荐些命令行神器" class="headerlink" title="推荐些命令行神器"></a>推荐些命令行神器</h4><p>话说，工欲善其事必先利其器。</p>
<p>方便好用，我也安装了，这个也是收集大部分网友的答案。</p>
<ul>
<li><p><a href="https://github.com/ggreer/the_silver_searcher" target="_blank" rel="noopener">ag</a>,比grep、ack更快的递归搜索文件内容。</p>
</li>
<li><p><a href="https://github.com/koalaman/shellcheck" target="_blank" rel="noopener">shellcheck</a>, shell脚本静态检查工具，能够识别语法错误以及不规范的写法。</p>
</li>
<li><p><a href="https://hisham.hm/htop/" target="_blank" rel="noopener">htop</a>, 提供更美观、更方便的进程监控工具，替代top命令。</p>
</li>
<li><p><a href="https://github.com/nicolargo/glances" target="_blank" rel="noopener">glances</a>, 更强大的 htop / top 代替者,做综合监控。在某些方面，并没有htop好。</p>
</li>
<li><p><a href="https://dev.yorhel.nl/ncdu" target="_blank" rel="noopener">ncdu</a>, 可视化的目录占用空间分析程序</p>
</li>
<li><p><a href="http://www.pandoc.org/" target="_blank" rel="noopener">pandoc</a>, 可以将 markdown 转成各式各样的格式：PDF、DOCX、EPUB、MOBI,我通产用它生成PPT和简历。</p>
</li>
<li><p><a href="http://www.graphviz.org/" target="_blank" rel="noopener">Graphviz</a>,可以将文本转化为图表</p>
</li>
<li><p><a href="https://github.com/jakubroztocil/httpie" target="_blank" rel="noopener">httpie</a>, 测试http接口的时候，感觉比curl简单。curl毕竟更底层些，但是curl却更加灵活。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/08/11/manjaro-hello/" data-id="cjtctqomz001bufqf03ls01y1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-avoid-win32-error-report-dialog" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/06/15/avoid-win32-error-report-dialog/" class="article-date">
  <time datetime="2018-06-15T10:58:23.000Z" itemprop="datePublished">2018-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/06/15/avoid-win32-error-report-dialog/">win32 进程崩溃时禁止弹出错误对话框</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在main函数程序初始化的时候加入以下代码即可：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetErrorMode(SEM_FAILCRITICALERRORS | SEM_NOGPFAULTERRORBOX); _set_abort_behavior(<span class="number">0</span>,_WRITE_ABORT_MSG);</span><br></pre></td></tr></table></figure>
<p>这样程序就悄无声息的崩溃了，不然守护进程都不起作用。如果不这样做，弹出错误对话框程序如果不点击关闭或发送错误报告就僵死在那里了，守护进程一直发现进程没挂，就不重启。</p>
<p>参考： <br><br>[1] <a href="https://stackoverflow.com/questions/9718695/how-can-i-supress-all-error-dialogs-when-a-process-crashes-i-only-want-it-to-cr" target="_blank" rel="noopener">https://stackoverflow.com/questions/9718695/how-can-i-supress-all-error-dialogs-when-a-process-crashes-i-only-want-it-to-cr</a></p>
<p>[2]<br><a href="https://stackoverflow.com/questions/1861506/prevent-modal-dialog-on-win32-process-crash" target="_blank" rel="noopener">https://stackoverflow.com/questions/1861506/prevent-modal-dialog-on-win32-process-crash</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/06/15/avoid-win32-error-report-dialog/" data-id="cjtctqom60002ufqfiqusp6av" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Win32/">Win32</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/调试/">调试</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-fix-vs-halting" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/06/06/fix-vs-halting/" class="article-date">
  <time datetime="2018-06-06T07:58:23.000Z" itemprop="datePublished">2018-06-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/06/06/fix-vs-halting/">解决Visual Studio调试突然变慢卡死的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最开始摸不到头脑，之前还能好好调试的啊，现在VS启动调试器变得巨卡。后来在VS的调试菜单的符号选项里面发现了系统环境变量_NT_SYMBOL_PATH 的值为：srv<em>c:\symbols</em><a href="http://msdl.microsoft.com/download/symbols" target="_blank" rel="noopener">http://msdl.microsoft.com/download/symbols</a></p>
<p>才想起来以前用WinDbg分析过Dump文件，需要到微软的http连接里面下载windows符号文件，所以就配置了该系统环境变量。</p>
<p>VS也能自动识别这个环境变量，就去下载符号文件去了，所以变得很慢并卡死了，晕。</p>
<p>参考： <br><br>[1] <a href="https://blog.csdn.net/caichengji1/article/details/77524961" target="_blank" rel="noopener">https://blog.csdn.net/caichengji1/article/details/77524961</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alexiachen.github.io/blog/2018/06/06/fix-vs-halting/" data-id="cjtctqomp000sufqftbjmgqw1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Visual-Studio/">Visual Studio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Win32/">Win32</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/调试/">调试</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/8/">8</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Bloom-Filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/blog/tags/C-C/" style="font-size: 20px;">C/C++</a> <a href="/blog/tags/CERT/" style="font-size: 18.33px;">CERT</a> <a href="/blog/tags/CMake/" style="font-size: 10px;">CMake</a> <a href="/blog/tags/DLL/" style="font-size: 10px;">DLL</a> <a href="/blog/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/blog/tags/IM/" style="font-size: 13.33px;">IM</a> <a href="/blog/tags/IO/" style="font-size: 10px;">IO</a> <a href="/blog/tags/Java/" style="font-size: 10px;">Java</a> <a href="/blog/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/blog/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/blog/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/blog/tags/Qos/" style="font-size: 11.67px;">Qos</a> <a href="/blog/tags/RFB协议/" style="font-size: 10px;">RFB协议</a> <a href="/blog/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/blog/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/blog/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/blog/tags/VNC协议/" style="font-size: 10px;">VNC协议</a> <a href="/blog/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/blog/tags/Win32/" style="font-size: 13.33px;">Win32</a> <a href="/blog/tags/Y组合子/" style="font-size: 10px;">Y组合子</a> <a href="/blog/tags/bat/" style="font-size: 10px;">bat</a> <a href="/blog/tags/ioccc/" style="font-size: 10px;">ioccc</a> <a href="/blog/tags/lambda演算/" style="font-size: 10px;">lambda演算</a> <a href="/blog/tags/windows/" style="font-size: 11.67px;">windows</a> <a href="/blog/tags/上下文无关文法/" style="font-size: 10px;">上下文无关文法</a> <a href="/blog/tags/事业/" style="font-size: 10px;">事业</a> <a href="/blog/tags/互联网/" style="font-size: 10px;">互联网</a> <a href="/blog/tags/人生/" style="font-size: 10px;">人生</a> <a href="/blog/tags/传统行业/" style="font-size: 10px;">传统行业</a> <a href="/blog/tags/信息安全/" style="font-size: 10px;">信息安全</a> <a href="/blog/tags/内存模型/" style="font-size: 10px;">内存模型</a> <a href="/blog/tags/函数式编程/" style="font-size: 11.67px;">函数式编程</a> <a href="/blog/tags/单例模式/" style="font-size: 10px;">单例模式</a> <a href="/blog/tags/双向链表/" style="font-size: 10px;">双向链表</a> <a href="/blog/tags/可计算性/" style="font-size: 10px;">可计算性</a> <a href="/blog/tags/同步异步/" style="font-size: 10px;">同步异步</a> <a href="/blog/tags/团队管理/" style="font-size: 11.67px;">团队管理</a> <a href="/blog/tags/多核编程/" style="font-size: 10px;">多核编程</a> <a href="/blog/tags/多线程编程/" style="font-size: 10px;">多线程编程</a> <a href="/blog/tags/天体物理/" style="font-size: 10px;">天体物理</a> <a href="/blog/tags/套路/" style="font-size: 10px;">套路</a> <a href="/blog/tags/学术/" style="font-size: 10px;">学术</a> <a href="/blog/tags/宇宙学/" style="font-size: 10px;">宇宙学</a> <a href="/blog/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/blog/tags/技术/" style="font-size: 10px;">技术</a> <a href="/blog/tags/指令重排序/" style="font-size: 10px;">指令重排序</a> <a href="/blog/tags/操作系统/" style="font-size: 10px;">操作系统</a> <a href="/blog/tags/敏捷开发/" style="font-size: 10px;">敏捷开发</a> <a href="/blog/tags/数据压缩/" style="font-size: 10px;">数据压缩</a> <a href="/blog/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/blog/tags/数据恢复/" style="font-size: 10px;">数据恢复</a> <a href="/blog/tags/数据结构与算法/" style="font-size: 11.67px;">数据结构与算法</a> <a href="/blog/tags/旅行/" style="font-size: 10px;">旅行</a> <a href="/blog/tags/无线网卡/" style="font-size: 10px;">无线网卡</a> <a href="/blog/tags/有限自动机/" style="font-size: 10px;">有限自动机</a> <a href="/blog/tags/构建工具/" style="font-size: 10px;">构建工具</a> <a href="/blog/tags/模板元编程/" style="font-size: 10px;">模板元编程</a> <a href="/blog/tags/民主/" style="font-size: 11.67px;">民主</a> <a href="/blog/tags/汇编语言/" style="font-size: 10px;">汇编语言</a> <a href="/blog/tags/消息推送/" style="font-size: 10px;">消息推送</a> <a href="/blog/tags/混乱代码/" style="font-size: 10px;">混乱代码</a> <a href="/blog/tags/物联网/" style="font-size: 10px;">物联网</a> <a href="/blog/tags/猎人/" style="font-size: 10px;">猎人</a> <a href="/blog/tags/理想/" style="font-size: 10px;">理想</a> <a href="/blog/tags/理论计算机/" style="font-size: 10px;">理论计算机</a> <a href="/blog/tags/生活/" style="font-size: 13.33px;">生活</a> <a href="/blog/tags/研究/" style="font-size: 10px;">研究</a> <a href="/blog/tags/程序语言理论/" style="font-size: 15px;">程序语言理论</a> <a href="/blog/tags/类型系统/" style="font-size: 10px;">类型系统</a> <a href="/blog/tags/线程/" style="font-size: 10px;">线程</a> <a href="/blog/tags/线程安全/" style="font-size: 10px;">线程安全</a> <a href="/blog/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/blog/tags/编程范式/" style="font-size: 10px;">编程范式</a> <a href="/blog/tags/编程语言/" style="font-size: 10px;">编程语言</a> <a href="/blog/tags/编译原理/" style="font-size: 11.67px;">编译原理</a> <a href="/blog/tags/美国/" style="font-size: 10px;">美国</a> <a href="/blog/tags/职业生涯/" style="font-size: 10px;">职业生涯</a> <a href="/blog/tags/自然语言处理/" style="font-size: 10px;">自然语言处理</a> <a href="/blog/tags/自由/" style="font-size: 11.67px;">自由</a> <a href="/blog/tags/英语/" style="font-size: 10px;">英语</a> <a href="/blog/tags/装修/" style="font-size: 10px;">装修</a> <a href="/blog/tags/计算机体系结构/" style="font-size: 10px;">计算机体系结构</a> <a href="/blog/tags/计算机科学/" style="font-size: 10px;">计算机科学</a> <a href="/blog/tags/计算机网络/" style="font-size: 11.67px;">计算机网络</a> <a href="/blog/tags/计算理论/" style="font-size: 11.67px;">计算理论</a> <a href="/blog/tags/词法分析/" style="font-size: 10px;">词法分析</a> <a href="/blog/tags/诗歌/" style="font-size: 10px;">诗歌</a> <a href="/blog/tags/语义学/" style="font-size: 10px;">语义学</a> <a href="/blog/tags/调试/" style="font-size: 11.67px;">调试</a> <a href="/blog/tags/软件工程/" style="font-size: 16.67px;">软件工程</a> <a href="/blog/tags/软件开发/" style="font-size: 10px;">软件开发</a> <a href="/blog/tags/软件调试/" style="font-size: 10px;">软件调试</a> <a href="/blog/tags/远程桌面/" style="font-size: 10px;">远程桌面</a> <a href="/blog/tags/逻辑/" style="font-size: 11.67px;">逻辑</a> <a href="/blog/tags/重构/" style="font-size: 10px;">重构</a> <a href="/blog/tags/错误处理/" style="font-size: 10px;">错误处理</a> <a href="/blog/tags/闭包/" style="font-size: 10px;">闭包</a> <a href="/blog/tags/阻塞非阻塞/" style="font-size: 10px;">阻塞非阻塞</a> <a href="/blog/tags/项目管理/" style="font-size: 11.67px;">项目管理</a> <a href="/blog/tags/马尔科夫链/" style="font-size: 10px;">马尔科夫链</a> <a href="/blog/tags/驱动开发/" style="font-size: 10px;">驱动开发</a> <a href="/blog/tags/黑洞/" style="font-size: 10px;">黑洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2013/06/">June 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2019/03/17/bloom-filter/">实现一个简单的高性能布隆过滤器</a>
          </li>
        
          <li>
            <a href="/blog/2019/03/10/auto-complete-markov-chain/">用马尔科夫链来做自动补全</a>
          </li>
        
          <li>
            <a href="/blog/2018/12/15/manjaro-rtl8821ce/">manjaro下安装配置无线网卡驱动</a>
          </li>
        
          <li>
            <a href="/blog/2018/11/11/cpp-closure/">C++的闭包</a>
          </li>
        
          <li>
            <a href="/blog/2018/10/15/finite-automaton/">最简单的计算机之有限自动机</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2013-2019 MathxH Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/blog/about" class="mobile-nav-link">About</a>
  
    <a href="/blog/resume" class="mobile-nav-link">Resume</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>



  </div>
</body>
</html>