<html>
<head><meta name="generator" content="Hexo 3.8.0">
	
	<title>用马尔科夫链来做自动补全</title>
	<meta name="keywords" content="fzb.me,冯宗宝,冯宗宝的blog">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/blog/css/main.css?v=3" rel="stylesheet" type="text/css">
    
        <script src="/blog/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=3">
    
    

</head>

<body>


<h2 class="title">用马尔科夫链来做自动补全</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2019年3月10日




 </div>
--->


<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正文"><span class="toc-text">正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>马尔科夫链是个什么呢？如果你去网上搜索， 噼里啪啦一堆公式，可能你会看的不耐烦了。当然，你可能见到有些人总结了一句经典的话，比如：</p>
<ul>
<li><p>如果将下一个状态的依赖条件，简化成：仅取决于当前状态，和之前其他状态无关。那么，这个随机过程就是马尔可夫链。</p>
</li>
<li><p>今天的事情只取决于昨天，而明天的事情只取决于今天，与历史毫无关联</p>
</li>
</ul>
<p>当然，你可以在<a href="https://www.zhihu.com/question/26665048" target="_blank" rel="noopener">知乎这里</a>看到更多的解释。</p>
<p>这样的性质就给我们带来了预测下一个状态带来了可能，比如天气预报，智能联想提示等等。</p>
<p>今天我们就用python来用马尔科夫链来做点有实际意义的事情，用更直观的角度理解它。</p>
<p>正文是我用python脚本来分析了一本英文书，把这本书的英文句子作为一个训练集，用<a href="https://en.wikipedia.org/wiki/Markov_chain" target="_blank" rel="noopener">马尔科夫链</a>来做处理产生短文，短文句子有一定“联想”，这样也可以算作是一个自动补全的程序了。比如，一些聊天工具和输入法可能就有这样的功能，基于你以前历史的语句输入来判断你当前输入后面可能会输入的单词或语句作提示或者补全。</p>
<p>网络社区也有一些爱好者用<a href="https://blog.csdn.net/renhaofan/article/details/82191387" target="_blank" rel="noopener">马尔科夫链来生成鸡汤文</a>， 都算是一定性质的科普文章。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><hr>
<p>首先，需要随便下载一个英文小说或者书籍来作为训练集合，英文当然越正宗越地道越好，这样的数据质量比较高，之后生成的段落语句结果也更好些。这里我下载了<a href="http://vdisk.weibo.com/s/uiFtZjZIxy3Gz" target="_blank" rel="noopener">哈利波特1-7的英文txt</a>。哈哈，英文原版我只读了第一部魔法石，惭愧啊。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python 3! due to random.choices()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> operator, random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_empty_words</span><span class="params">(l)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> list(filter(<span class="keyword">lambda</span> a: a != <span class="string">''</span>, l))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_occ</span><span class="params">(d, seq, w)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> seq <span class="keyword">not</span> <span class="keyword">in</span> d:</span><br><span class="line">        d[seq]=defaultdict(int)</span><br><span class="line"></span><br><span class="line">    d[seq][w]=d[seq][w]+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://docs.python.org/3/library/random.html#random.choice</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_random_from_table</span><span class="params">(t)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> random.choices(list(t.keys()), weights=list(t.values()))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">with</span> open (<span class="string">"harry-potter.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> myfile:</span><br><span class="line">        data=myfile.read()</span><br><span class="line"></span><br><span class="line">    sentences=data.lower().replace(<span class="string">'\r'</span>,<span class="string">' '</span>).replace(<span class="string">'\n'</span>,<span class="string">' '</span>).replace(<span class="string">'?'</span>,<span class="string">'.'</span>).replace(<span class="string">'!'</span>,<span class="string">'.'</span>).replace(<span class="string">'“'</span>,<span class="string">'.'</span>).replace(<span class="string">'”'</span>,<span class="string">'.'</span>).replace(<span class="string">"\""</span>,<span class="string">"."</span>).replace(<span class="string">'‘'</span>,<span class="string">' '</span>).replace(<span class="string">'-'</span>,<span class="string">' '</span>).replace(<span class="string">'’'</span>,<span class="string">' '</span>).replace(<span class="string">'\''</span>,<span class="string">' '</span>).split(<span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># key=list of words, as a string, delimited by space</span></span><br><span class="line">    <span class="comment">#     (I would use list of strings here as key, but list in not hashable)</span></span><br><span class="line">    <span class="comment"># val=dict, k: next word; v: occurrences</span></span><br><span class="line">    first=&#123;&#125;</span><br><span class="line">    second=&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> sentences:</span><br><span class="line">        words=s.replace(<span class="string">','</span>,<span class="string">' '</span>).split(<span class="string">" "</span>)</span><br><span class="line">        words=remove_empty_words(words)</span><br><span class="line">        <span class="keyword">if</span> len(words)==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(words)):</span><br><span class="line">            <span class="keyword">if</span> i&gt;=<span class="number">1</span>:</span><br><span class="line">                update_occ(first, words[i<span class="number">-1</span>], words[i])</span><br><span class="line">            <span class="keyword">if</span> i&gt;=<span class="number">2</span>:</span><br><span class="line">                update_occ(second, words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>], words[i])</span><br><span class="line"></span><br><span class="line">    text=[<span class="string">"magic"</span>, <span class="string">"is"</span>]</span><br><span class="line"></span><br><span class="line">    text_len=len(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line"></span><br><span class="line">        last_idx=text_len<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        tmp=text[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+text[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> second:</span><br><span class="line">            new_word=gen_random_from_table(second[tmp])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># fall-back to 1st order</span></span><br><span class="line">            tmp2=text[last_idx]</span><br><span class="line">            <span class="keyword">if</span> tmp2 <span class="keyword">not</span> <span class="keyword">in</span> first:</span><br><span class="line">                <span class="comment"># dead-end</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            new_word=gen_random_from_table(first[tmp2])</span><br><span class="line"></span><br><span class="line">        text.append(new_word)</span><br><span class="line">        text_len=text_len+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">" "</span>.join(text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># main function</span></span><br><span class="line">process()</span><br></pre></td></tr></table></figure>
<p>运行以上代码，就可以生成一个150来个单词的”联想”短文了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">magic is not having practised vanishing spells horribly difficult at first but they two thousand racing broom tampering and torture; </span><br><span class="line">an interview said harry leaping to their bulky backpacks the nine of the cottages were fewer here and make it too far; </span><br><span class="line">it rolled over toward him holding a wand to shoulder wands raised james glancing over his head pound so he went as red as ron who clambered to</span><br><span class="line"> his determination to shut his eyes wanting to know anything new right before you go upstairs with ron eating their way around the walls and </span><br><span class="line"> all their shock and exhaustion that the phoenix but after a few horrible seconds he did to open the lestranges vault only once a month </span><br><span class="line"> later harry kept his eyes was twitching slightly hair whipped back off the </span><br><span class="line"> pitch but all three of my followers would give better cover they extinguished their fire then he sat down when something of a voice </span><br><span class="line"> and called out of pure venom at harry his temper getting the exit and when sounds of someone stumbling ftom a room like a venomous bubble compressing his lungs driving all other concerns fled </span><br><span class="line"> harry s head with a large fir tree blocking the top</span><br></pre></td></tr></table></figure>
<p>当然这段短文有点狗屁不通，甚至有点搞笑，我们现在先不管。</p>
<p>我们先来看看代码中的first和second变量，它们是一个字典。</p>
<p>first变量表示第一个单词后出现的单词的概率统计，这是一阶马尔科夫链生成的数据结果。</p>
<p>我们通过python把first的结果排序打印出来好了:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> (<span class="string">"first table:"</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> first:</span><br><span class="line">    <span class="keyword">print</span> (k)</span><br><span class="line">    <span class="comment"># https://stackoverflow.com/questions/613183/how-do-i-sort-a-dictionary-by-value</span></span><br><span class="line">    s=sorted(first[k].items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">print</span> (s[:<span class="number">20</span>])</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">harry</span><br><span class="line">[(&apos;s&apos;, 1344), (&apos;and&apos;, 776), (&apos;had&apos;, 657), (&apos;was&apos;, 475), (&apos;could&apos;, 400), (&apos;potter&apos;, 385), (&apos;said&apos;, 358), (&apos;saw&apos;, 271), (&apos;looked&apos;, 241), (&apos;felt&apos;, 238), (&apos;ron&apos;, 233), (&apos;who&apos;, 201), (&apos;thought&apos;, 172), (&apos;asked&apos;, 163), (&apos;as&apos;, 160), (&apos;knew&apos;, 156), (&apos;did&apos;, 125), (&apos;i&apos;, 115), (&apos;to&apos;, 108), (&apos;in&apos;, 106)]</span><br><span class="line"></span><br><span class="line">potter</span><br><span class="line">[(&apos;and&apos;, 63), (&apos;s&apos;, 59), (&apos;said&apos;, 28), (&apos;is&apos;, 26), (&apos;you&apos;, 23), (&apos;has&apos;, 21), (&apos;i&apos;, 18), (&apos;the&apos;, 17), (&apos;was&apos;, 13), (&apos;he&apos;, 13), (&apos;sir&apos;, 13), (&apos;will&apos;, 10), (&apos;had&apos;, 10), (&apos;she&apos;, 10), (&apos;in&apos;, 9), (&apos;must&apos;, 9), (&apos;that&apos;, 9), (&apos;stinks&apos;, 7), (&apos;not&apos;, 6), (&apos;come&apos;, 5)]</span><br><span class="line"></span><br><span class="line">and</span><br><span class="line">[(&apos;the&apos;, 1225), (&apos;hermione&apos;, 954), (&apos;he&apos;, 907), (&apos;harry&apos;, 662), (&apos;a&apos;, 605), (&apos;then&apos;, 554), (&apos;ron&apos;, 550), (&apos;i&apos;, 541), (&apos;his&apos;, 363), (&apos;george&apos;, 341), (&apos;it&apos;, 298), (&apos;they&apos;, 289), (&apos;you&apos;, 253), (&apos;she&apos;, 243), (&apos;was&apos;, 232), (&apos;that&apos;, 211), (&apos;there&apos;, 190), (&apos;saw&apos;, 187), (&apos;said&apos;, 171), (&apos;looked&apos;, 161)]</span><br><span class="line"></span><br><span class="line">the</span><br><span class="line">[(&apos;door&apos;, 770), (&apos;dark&apos;, 637), (&apos;room&apos;, 629), (&apos;other&apos;, 548), (&apos;ministry&apos;, 477), (&apos;first&apos;, 455), (&apos;floor&apos;, 408), (&apos;same&apos;, 386), (&apos;way&apos;, 362), (&apos;end&apos;, 362), (&apos;castle&apos;, 358), (&apos;air&apos;, 334), (&apos;ground&apos;, 326), (&apos;only&apos;, 326), (&apos;back&apos;, 317), (&apos;last&apos;, 296), (&apos;table&apos;, 292), (&apos;rest&apos;, 284), (&apos;front&apos;, 263), (&apos;death&apos;, 260)]</span><br><span class="line"></span><br><span class="line">sorcerer</span><br><span class="line">[(&apos;s&apos;, 24), (&apos;in&apos;, 3), (&apos;of&apos;, 1), (&apos;spoke&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>好了，我们现在再来看看second变量的结果，它表示两个单词之后出现的每个单词的概率统计，这是二阶马尔科夫链的结果，依次类推，还有3阶马尔科夫链，只不过代码里面没写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> (<span class="string">"second table:"</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> second:</span><br><span class="line">        <span class="keyword">print</span> (k)</span><br><span class="line">        <span class="comment"># https://stackoverflow.com/questions/613183/how-do-i-sort-a-dictionary-by-value</span></span><br><span class="line">        s=sorted(second[k].items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">print</span> (s[:<span class="number">20</span>])</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">which made</span><br><span class="line">[(&apos;the&apos;, 3), (&apos;it&apos;, 2), (&apos;harry&apos;, 2), (&apos;drills&apos;, 1), (&apos;professor&apos;, 1), (&apos;ginny&apos;, 1), (&apos;his&apos;, 1), (&apos;ron&apos;, 1), (&apos;him&apos;, 1), (&apos;a&apos;, 1)]</span><br><span class="line"></span><br><span class="line">he was</span><br><span class="line">[(&apos;going&apos;, 96), (&apos;not&apos;, 88), (&apos;a&apos;, 66), (&apos;still&apos;, 65), (&apos;sure&apos;, 50), (&apos;in&apos;, 47), (&apos;doing&apos;, 43), (&apos;the&apos;, 42), (&apos;looking&apos;, 40), (&apos;wearing&apos;, 38), (&apos;so&apos;, 32), (&apos;about&apos;, 29), (&apos;trying&apos;, 29), (&apos;on&apos;, 27), (&apos;being&apos;, 25), (&apos;very&apos;, 22), (&apos;lying&apos;, 22), (&apos;standing&apos;, 22), (&apos;too&apos;, 19), (&apos;supposed&apos;, 19)]</span><br><span class="line"></span><br><span class="line">was a</span><br><span class="line">[(&apos;very&apos;, 48), (&apos;loud&apos;, 39), (&apos;pause&apos;, 35), (&apos;great&apos;, 35), (&apos;long&apos;, 25), (&apos;bit&apos;, 22), (&apos;little&apos;, 20), (&apos;good&apos;, 19), (&apos;large&apos;, 16), (&apos;moment&apos;, 16), (&apos;flash&apos;, 15), (&apos;few&apos;, 14), (&apos;small&apos;, 14), (&apos;tiny&apos;, 13), (&apos;wizard&apos;, 12), (&apos;bang&apos;, 12), (&apos;nasty&apos;, 11), (&apos;knock&apos;, 11), (&apos;sudden&apos;, 11), (&apos;lot&apos;, 10)]</span><br><span class="line"></span><br><span class="line">a big</span><br><span class="line">[(&apos;mistake&apos;, 3), (&apos;deal&apos;, 3), (&apos;plastic&apos;, 2), (&apos;supporter&apos;, 2), (&apos;party&apos;, 2), (&apos;man&apos;, 2), (&apos;beefy&apos;, 1), (&apos;city&apos;, 1), (&apos;argument&apos;, 1), (&apos;old&apos;, 1), (&apos;photograph&apos;, 1), (&apos;green&apos;, 1), (&apos;lumpy&apos;, 1), (&apos;black&apos;, 1), (&apos;red&apos;, 1), (&apos;thing&apos;, 1), (&apos;drop&apos;, 1), (&apos;enough&apos;, 1), (&apos;bet&apos;, 1), (&apos;bearded&apos;, 1)]</span><br><span class="line"></span><br><span class="line">big beefy</span><br><span class="line">[(&apos;man&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>好了，这里先暂时止步探索，你会发现二阶马尔科夫链的结果更加精确，生成的数据集也更加小。这不废话嘛，就像猜谜语一样，提示给的越精确越多，那么你猜中的概率越大，解的空间范围就缩小了，second表也就更小了。哈哈，开始有点意思了。</p>
<p>好的，我们现在在二阶马尔科夫链的基础上加入3阶马尔科夫链，按照2阶的代码修改就行了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">first=&#123;&#125;</span><br><span class="line">second=&#123;&#125;</span><br><span class="line">third=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> sentences:</span><br><span class="line">    words=s.replace(<span class="string">','</span>,<span class="string">' '</span>).split(<span class="string">" "</span>)</span><br><span class="line">    words=remove_empty_words(words)</span><br><span class="line">    <span class="keyword">if</span> len(words)==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(words)):</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">1</span>:</span><br><span class="line">            update_occ(first, words[i<span class="number">-1</span>], words[i])</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">2</span>:</span><br><span class="line">            update_occ(second, words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>], words[i])</span><br><span class="line">        <span class="keyword">if</span> i&gt;=<span class="number">3</span>:</span><br><span class="line">            update_occ(third, words[i<span class="number">-3</span>]+<span class="string">" "</span>+words[i<span class="number">-2</span>]+<span class="string">" "</span>+words[i<span class="number">-1</span>],words[i])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">were proud to</span><br><span class="line">[(&apos;say&apos;, 1)]</span><br><span class="line"></span><br><span class="line">proud to say</span><br><span class="line">[(&apos;that&apos;, 1)]</span><br><span class="line"></span><br><span class="line">to say that</span><br><span class="line">[(&apos;he&apos;, 3), (&apos;she&apos;, 3), (&apos;i&apos;, 2), (&apos;they&apos;, 1), (&apos;s&apos;, 1), (&apos;you&apos;, 1), (&apos;his&apos;, 1), (&apos;from&apos;, 1), (&apos;your&apos;, 1), (&apos;at&apos;, 1), (&apos;on&apos;, 1), (&apos;age&apos;, 1), (&apos;dumbledore&apos;, 1), (&apos;it&apos;, 1)]</span><br><span class="line"></span><br><span class="line">say that they</span><br><span class="line">[(&apos;were&apos;, 1), (&apos;know&apos;, 1)]</span><br><span class="line"></span><br><span class="line">that they were</span><br><span class="line">[(&apos;not&apos;, 9), (&apos;all&apos;, 7), (&apos;there&apos;, 3), (&apos;going&apos;, 3), (&apos;alone&apos;, 2), (&apos;being&apos;, 2), (&apos;indeed&apos;, 2), (&apos;in&apos;, 2), (&apos;a&apos;, 2), (&apos;the&apos;, 2), (&apos;still&apos;, 2), (&apos;supposed&apos;, 2), (&apos;no&apos;, 2), (&apos;really&apos;, 2), (&apos;perfectly&apos;, 1), (&apos;related&apos;, 1), (&apos;proud&apos;, 1), (&apos;witches&apos;, 1), (&apos;fifty&apos;, 1), (&apos;already&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p>从以上可以看出，3阶显然更精确，并且third表也更小了。</p>
<p>以下为了让各位观众更清晰的看到3阶马尔科夫链的生成结果更准确，我用更加可读的输出打印出来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tests=[<span class="string">"i can tell"</span>, <span class="string">"who did this"</span>, <span class="string">"she was a"</span>, <span class="string">"he was a"</span>, <span class="string">"i did not"</span>,</span><br><span class="line">    <span class="string">"wanted to do"</span>, <span class="string">"you will find"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> test <span class="keyword">in</span> tests:</span><br><span class="line">    test_words=test.split(<span class="string">" "</span>)</span><br><span class="line"></span><br><span class="line">    test_len=len(test_words)</span><br><span class="line">    last_idx=test_len<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">3</span>:</span><br><span class="line">        tmp=test_words[last_idx<span class="number">-2</span>]+<span class="string">" "</span>+test_words[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> third:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* third order. for sequence:"</span>,tmp)</span><br><span class="line">            print_stat(third[tmp])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">2</span>:</span><br><span class="line">        tmp=test_words[last_idx<span class="number">-1</span>]+<span class="string">" "</span>+test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> second:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* second order. for sequence:"</span>, tmp)</span><br><span class="line">            print_stat(second[tmp])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test_len&gt;=<span class="number">1</span>:</span><br><span class="line">        tmp=test_words[last_idx]</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> first:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"* first order. for word:"</span>, tmp)</span><br><span class="line">            print_stat(first[tmp])</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">* third order. <span class="keyword">for</span> sequence: i can tell</span><br><span class="line">you <span class="number">42</span>%</span><br><span class="line">yeh <span class="number">14</span>%</span><br><span class="line">who <span class="number">7</span>%</span><br><span class="line">he <span class="number">7</span>%</span><br><span class="line">mum <span class="number">7</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: can tell</span><br><span class="line">me <span class="number">25</span>%</span><br><span class="line">you <span class="number">20</span>%</span><br><span class="line">us <span class="number">10</span>%</span><br><span class="line">yeh <span class="number">5</span>%</span><br><span class="line">him <span class="number">5</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: tell</span><br><span class="line">you <span class="number">17</span>%</span><br><span class="line">me <span class="number">14</span>%</span><br><span class="line">him <span class="number">10</span>%</span><br><span class="line">us <span class="number">7</span>%</span><br><span class="line">them <span class="number">5</span>%</span><br><span class="line"></span><br><span class="line">* second order. <span class="keyword">for</span> sequence: did this</span><br><span class="line">mean <span class="number">27</span>%</span><br><span class="line">but <span class="number">9</span>%</span><br><span class="line">year <span class="number">9</span>%</span><br><span class="line">weird <span class="number">9</span>%</span><br><span class="line">band <span class="number">9</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: this</span><br><span class="line"><span class="keyword">is</span> <span class="number">10</span>%</span><br><span class="line">time <span class="number">6</span>%</span><br><span class="line">was <span class="number">5</span>%</span><br><span class="line">year <span class="number">2</span>%</span><br><span class="line">one <span class="number">2</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: she was a</span><br><span class="line">witch <span class="number">12</span>%</span><br><span class="line">bit <span class="number">12</span>%</span><br><span class="line">great <span class="number">8</span>%</span><br><span class="line">very <span class="number">8</span>%</span><br><span class="line">freak <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: was a</span><br><span class="line">very <span class="number">3</span>%</span><br><span class="line">loud <span class="number">3</span>%</span><br><span class="line">pause <span class="number">2</span>%</span><br><span class="line">great <span class="number">2</span>%</span><br><span class="line">long <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: a</span><br><span class="line">few <span class="number">2</span>%</span><br><span class="line">little <span class="number">2</span>%</span><br><span class="line">bit <span class="number">1</span>%</span><br><span class="line">moment <span class="number">1</span>%</span><br><span class="line">very <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: he was a</span><br><span class="line">bit <span class="number">7</span>%</span><br><span class="line">good <span class="number">7</span>%</span><br><span class="line">wizard <span class="number">6</span>%</span><br><span class="line">death <span class="number">6</span>%</span><br><span class="line">big <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: was a</span><br><span class="line">very <span class="number">3</span>%</span><br><span class="line">loud <span class="number">3</span>%</span><br><span class="line">pause <span class="number">2</span>%</span><br><span class="line">great <span class="number">2</span>%</span><br><span class="line">long <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: a</span><br><span class="line">few <span class="number">2</span>%</span><br><span class="line">little <span class="number">2</span>%</span><br><span class="line">bit <span class="number">1</span>%</span><br><span class="line">moment <span class="number">1</span>%</span><br><span class="line">very <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: i did <span class="keyword">not</span></span><br><span class="line">want <span class="number">12</span>%</span><br><span class="line">have <span class="number">8</span>%</span><br><span class="line">know <span class="number">8</span>%</span><br><span class="line">ask <span class="number">4</span>%</span><br><span class="line">fasten <span class="number">4</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: did <span class="keyword">not</span></span><br><span class="line">know <span class="number">8</span>%</span><br><span class="line">want <span class="number">7</span>%</span><br><span class="line">seem <span class="number">6</span>%</span><br><span class="line">answer <span class="number">4</span>%</span><br><span class="line">look <span class="number">3</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: <span class="keyword">not</span></span><br><span class="line">to <span class="number">7</span>%</span><br><span class="line">be <span class="number">3</span>%</span><br><span class="line">a <span class="number">2</span>%</span><br><span class="line">have <span class="number">2</span>%</span><br><span class="line">the <span class="number">1</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: wanted to do</span><br><span class="line">was <span class="number">33</span>%</span><br><span class="line">the <span class="number">16</span>%</span><br><span class="line">but <span class="number">8</span>%</span><br><span class="line"><span class="keyword">with</span> <span class="number">8</span>%</span><br><span class="line">his <span class="number">8</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: to do</span><br><span class="line"><span class="keyword">with</span> <span class="number">20</span>%</span><br><span class="line">it <span class="number">14</span>%</span><br><span class="line">the <span class="number">4</span>%</span><br><span class="line">something <span class="number">3</span>%</span><br><span class="line">was <span class="number">2</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: do</span><br><span class="line">you <span class="number">20</span>%</span><br><span class="line">it <span class="number">12</span>%</span><br><span class="line"><span class="keyword">not</span> <span class="number">8</span>%</span><br><span class="line"><span class="keyword">with</span> <span class="number">6</span>%</span><br><span class="line">that <span class="number">3</span>%</span><br><span class="line"></span><br><span class="line">* third order. <span class="keyword">for</span> sequence: you will find</span><br><span class="line">that <span class="number">28</span>%</span><br><span class="line">a <span class="number">14</span>%</span><br><span class="line">unless <span class="number">7</span>%</span><br><span class="line">everything <span class="number">7</span>%</span><br><span class="line">on <span class="number">7</span>%</span><br><span class="line">* second order. <span class="keyword">for</span> sequence: will find</span><br><span class="line">that <span class="number">23</span>%</span><br><span class="line">it <span class="number">14</span>%</span><br><span class="line">me <span class="number">9</span>%</span><br><span class="line">a <span class="number">9</span>%</span><br><span class="line">uses <span class="number">4</span>%</span><br><span class="line">* first order. <span class="keyword">for</span> word: find</span><br><span class="line">out <span class="number">19</span>%</span><br><span class="line">a <span class="number">8</span>%</span><br><span class="line">the <span class="number">7</span>%</span><br><span class="line">it <span class="number">5</span>%</span><br><span class="line">him <span class="number">4</span>%</span><br></pre></td></tr></table></figure>
<p>从上面的输出可以看出，i can tell 接 you这个单词的概率42%，要比can tell 接 you这个单词的概率20% 要大。显然结果就更精确了。如果调试得当，那么生成的短文结果可能还真看起来像那么回事。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><hr>
<p>最后，提示一下，first，second，third这三张表可以结合起来使用，third这张表的权重显然更高，依次类推。如果你正在做一个输入法或者聊天提示的功能，可以简单采用这样的方法，先收集用户的输入语句等信息作为训练集合，来构建这几张表，这几张表的优先级最高，优先级最低的是常用的固定成语，词语的搭配，还有流行网络用语等等。</p>


<!--<a href="https://alexiachen.github.io/blog/2019/03/10/auto-complete-markov-chain/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>






</body>
</html>